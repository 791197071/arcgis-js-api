// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/next/esri/copyright.txt for details.

define(["require","exports","../compilerUtils","../Logger"],function(e,n,r,t){function u(e,n){return n.isInstanceOf?n.isInstanceOf(e):n instanceof e}function o(e){return null==e?e:new Date(e)}function a(e){return null==e?e:!!e}function i(e){return null==e?e:e.toString()}function s(e){return null==e?e:"number"==typeof e&&isNaN(e)?0:parseFloat(e)}function l(e){return null==e?e:Math.round(parseFloat(e))}function c(e){return e&&e.constructor&&void 0!==e.constructor._meta}function f(e,n){return null!=n&&e&&!u(e,n)}function y(e){return e&&("isCollection"in e||e._meta&&e._meta.bases&&e._meta.bases.some(function(e){return"isCollection"in e}))}function p(e){return e&&e.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function v(e,n){if(!n||!n.constructor||!y(n.constructor))return d(e,n)?n:new e(n);var r=p(e.prototype.itemType),t=p(n.constructor.prototype.itemType);if(!r)return n;if(!t)return new e(n);if(r===t)return n;var u=t._meta&&t._meta.bases;return u&&-1!==u.indexOf(r)?new e(n):(d(e,n),n)}function d(e,n){return!!c(n)&&(D.error("Accessor#set","Assigning an instance of '"+(n.declaredClass||"unknown")+"' which is not a subclass of '"+b(e)+"'"),!0)}function g(e,n){return null==n?n:y(e)?v(e,n):f(e,n)?d(e,n)?n:new e(n):n}function b(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}function h(e){switch(e){case Number:return s;case F:return l;case Boolean:return a;case String:return i;case Date:return o;default:return g.bind(null,e)}}function m(e,n){var r=h(e);return 1===arguments.length?r:r(n)}function A(e,n,r){return 1===arguments.length?A.bind(null,e):n?Array.isArray(n)?n.map(function(n){return e(n,r)}):[e(n,r)]:n}function w(e,n){return 1===arguments.length?A(m.bind(null,e)):A(m.bind(null,e),n)}function T(e,n,r){return 0!==n&&Array.isArray(r)?r.map(function(r){return T(e,n-1,r)}):e(r)}function O(e,n,r){if(2===arguments.length)return O.bind(null,e,n);if(!r)return r;r=T(e,n,r);for(var t=n,u=r;t>0&&Array.isArray(u);)t--,u=u[0];if(void 0!==u)for(var o=0;o<t;o++)r=[r];return r}function N(e,n,r){return 2===arguments.length?O(m.bind(null,e),n):O(m.bind(null,e),n,r)}function j(e){return!!Array.isArray(e)&&!e.some(function(n){var r=typeof n;return!("string"===r||"number"===r||"function"===r&&e.length>1)})}function k(e,n){if(2===arguments.length)return k(e).call(null,n);for(var r=new Set,t=e.filter(function(e){return"function"!=typeof e}),u=e.filter(function(e){return"function"==typeof e}),o=0,a=e;o<a.length;o++){var i=a[o];"string"!=typeof i&&"number"!=typeof i||r.add(i)}var s=null,l=null;return function(e,n){if(null==e)return e;var o=typeof e,a="string"===o||"number"===o;return a&&(r.has(e)||u.some(function(e){return"string"===o&&e===String||"number"===o&&e===Number}))?e:"object"===o&&u.some(function(n){return!f(e,n)})?e:(a&&t.length?(s||(s=t.map(function(e){return"string"==typeof e?"'"+e+"'":""+e}).join(", ")),D.error("Accessor#set","'"+e+"' is not a valid value for this property, only the following values are valid: "+s)):"object"==typeof e&&u.length?(l||(l=u.map(function(e){return b(e)}).join(", ")),D.error("Accessor#set","'"+e+"' is not a valid value for this property, value must be one of "+l)):D.error("Accessor#set","'"+e+"' is not a valid value for this property"),n&&(n.valid=!1),null)}}function S(e,n){if(2===arguments.length)return S(e).call(null,n);var r={},t=[],u=[];for(var o in e.typeMap){var a=e.typeMap[o];r[o]=m(a),t.push(b(a)),u.push(o)}var i=function(){return"'"+t.join("', '")+"'"},s=function(){return"'"+u.join("', '")+"'"},l="string"==typeof e.key?function(n){return n[e.key]}:e.key;return function(n){if(e.base&&!f(e.base,n))return n;if(null==n)return n;var t=l(n)||e.defaultKeyValue,u=r[t];if(!u)return D.error("Accessor#set","Invalid property value, value needs to be one of "+i()+", or a plain object that can autocast (having .type = "+s()+")"),null;if(!f(e.typeMap[t],n))return n;if("string"==typeof e.key&&!c(n)){var o={};for(var a in n)a!==e.key&&(o[a]=n[a]);return u(o)}return u(n)}}function _(e){if(!(e&&"type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0;default:r.neverReachedSilent(e)}return!1}function I(e){switch(e.type){case"native":return m(e.value);case"array":return A(I(e.value));case"one-of":return C(e);default:r.neverReached(e)}return null}function C(e){var n=null;return function(r,t){return B(r,e)?r:(null==n&&(n=M(e)),D.error("Accessor#set","Invalid property value, value needs to be of type "+n),t&&(t.valid=!1),null)}}function M(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case F:return"integer";case Date:return"date";default:return b(e.value)}case"array":return"array of "+M(e.value);case"one-of":var n=e.values.map(function(e){return M(e)});return"one of "+n.slice(0,n.length-1)+" or "+n[n.length-1];default:r.neverReached(e)}return"unknown"}function B(e,n){if(null==e)return!0;switch(n.type){case"native":switch(n.value){case Number:case F:return"number"==typeof e;case Boolean:return"boolean"==typeof e;case String:return"string"==typeof e}return e instanceof n.value;case"array":return!!Array.isArray(e)&&!e.some(function(e){return!B(e,n.value)});case"one-of":return n.values.some(function(n){return B(e,n)})}}Object.defineProperty(n,"__esModule",{value:!0});var D=t.getLogger("esri.core.Accessor");n.isInstanceOf=u,n.ensureDate=o,n.ensureBoolean=a,n.ensureString=i,n.ensureNumber=s,n.ensureInteger=l,n.isClassedType=c,n.requiresType=f,n.ensureClass=g,n.ensureType=m,n.ensureArrayTyped=A,n.ensureArray=w,n.ensureNArrayTyped=O,n.ensureNArray=N,n.isOneOf=j,n.ensureOneOf=k,n.ensureOneOfType=S;var F=function(){function e(){}return e}();n.Integer=F,n.types={native:function(e){return{type:"native",value:e}},array:function(e){return{type:"array",value:e}},oneOf:function(e){return{type:"one-of",values:e}}},n.isLongFormType=_,n.ensureLongFormType=I,n.default=m});