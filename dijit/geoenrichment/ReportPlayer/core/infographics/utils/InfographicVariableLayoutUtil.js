// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.31/esri/copyright.txt for details.

define(["esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/MathUtil","../../annotations/shape/ShapeJsonUtil"],function(t,e,i){var h={};return h.VARIABLE_LAYOUTS=[{value:"v1",hasIcon:!0,hasDesc:!0},{value:"v1-d",hasIcon:!0,hasDesc:!1},{value:"v2",hasIcon:!0,hasDesc:!0},{value:"v3",hasIcon:!0,hasDesc:!0},{value:"v4",hasIcon:!1,hasDesc:!0},{value:"v5",hasIcon:!1,hasDesc:!1}],h.getIdObj=function(t){return h.VARIABLE_LAYOUTS.filter(function(e){return e.value===t})[0]},h.getClosestId=function(t,e){var i=h.hasIcon(t),n=!!t.description;if(t.shape&&t.shape.shapeJson.isPlaceholder)return"v1";if(!i&&!n)return"v5";var a=h.getBoxes(t);return i?a.variableCenter.y>a.iconBox.y+a.iconBox.h?n?"v1":"v1-d":a.variableCenter.x>a.iconBox.x+a.iconBox.w?"v3":h.isVariableInShape(t)?"v2":void 0!==e?e:n?"v1":"v1-d":"v4"},h.hasIcon=function(t){return t&&(t.shape&&!i.isEmptyShapeJson(t.shape.shapeJson)||t.image)},h.isVariableInShape=function(t){if(!h.hasIcon(t))return!1;var i=h.getBoxes(t);return e.isPointInRect(i.iconBox,i.variableCenter)&&e.isPointInRect(i.variableBox,i.iconCenter)},h.getBoxes=function(t){var e={};if(h.hasIcon(t)){var i=t.image?t.image.style:t.shape.style,n={x:i.left,y:i.top,w:i.width,h:i.height};e.iconBox=n,e.iconCenter={x:n.x+n.w/2,y:n.y+n.h/2}}var a=t.variable.style,l={x:a.left,y:a.top,w:a.width,h:a.height};if(e.variableBox=l,e.variableCenter={x:l.x+l.w/2,y:l.y+l.h/2},t.description){var o=t.description.style,r={x:o.left,y:o.top,w:o.width,h:o.height};e.descriptionBox=r,e.descriptionCenter={x:r.x+r.w/2,y:r.y+r.h/2}}return e},h.getActualShapeBox=function(e,h){if(i.isEmptyShapeJson(e.shapeJson))return null;var n=h.layoutBuilder.createElement("shape",{node:document.body,json:e.shapeJson,creationParams:{viewModel:h,applyThemeStyle:!1}}),a=n.getSvgNode(),l=t.getNodesBox(a.children);return n.destroy(),l&&{x:l.x+(e.style.width-l.w)/2,y:l.y+(e.style.height-l.h)/2,w:l.w,h:l.h}},h.calcLayout=function(t,e,i){function h(t,e){var i=Math.max(50,Math.min(200,n.height)),h=(i-50)/150;return t*(1-h)+e*h}var n=t.style,a=t.shape?t.shape.style:t.image&&t.image.style,l=t.variable&&t.variable.style,o=t.description&&t.description.style,r=i&&i.noPadding;if("v1"===e){var g=n.width*(r?0:.1),s=n.width-2*g;a.left=g,a.top=0,a.width=s,a.height=h(.35*n.height,.55*n.height),l.left=g,l.top=h(.35*n.height,.55*n.height),l.width=s,l.height=h(.35*n.height,.2*n.height),l.verticalAlign="middle",o.left=g,o.top=h(.7*n.height,.75*n.height),o.width=s,o.height=h(.3*n.height,.25*n.height),o.horizontalAlign="center",o.verticalAlign="top"}if("v1-d"===e){var g=n.width*(r?0:.1),s=n.width-2*g;a.left=g,a.top=0,a.width=s,a.height=h(.6*n.height,.8*n.height),l.left=g,l.top=h(.6*n.height,.8*n.height),l.width=s,l.height=h(.4*n.height,.2*n.height),l.verticalAlign="middle"}else if("v2"===e){a.left=.15*n.width,a.top=0,a.width=.7*n.width,a.height=.725*n.height;var d=.3625*n.height,c=d>=30?1:30/d;l.left=.2*n.width,l.top=.18125*n.height/c,l.width=.6*n.width,l.height=d*c,l.verticalAlign="middle",o.left=.1*n.width,o.top=h(.725*n.height,.75*n.height),o.width=n.width-2*o.left,o.height=h(.275*n.height,.25*n.height),o.horizontalAlign="center",o.verticalAlign="top"}else if("v3"===e)t.shape&&t.shape.shapeJson.showAsBar?(a.left=.03*n.width,a.top=.1*n.height,a.width=.65*n.width,a.height=.5*n.height,l.left=.65*n.width,l.top=.1*n.height,l.width=.35*n.width,l.height=.5*n.height,l.verticalAlign="middle",o.left=.03*n.width,o.top=.6*n.height,o.width=.65*n.width,o.height=.33*n.height,o.horizontalAlign="left",o.verticalAlign="top"):(a.left=.025*n.width,a.top=0*n.height,a.width=.5*n.width,a.height=.725*n.height,l.left=.525*n.width,l.top=0*n.height,l.width=.475*n.width,l.height=.725*n.height,l.verticalAlign="middle",o.left=.025*n.width,o.top=h(.725*n.height,.75*n.height),o.width=.5*n.width,o.height=h(.275*n.height,.25*n.height),o.horizontalAlign="center",o.verticalAlign="top");else if("v4"===e){l.left=0,l.top=0,l.width=n.width,l.height=h(.5*n.height,.725*n.height),l.verticalAlign="middle";var v=t.variable;!v.style.fontSize&&v.themeStyle&&v.themeStyle.fontSize&&(v.style.fontSize=Math.round(1.33*v.themeStyle.fontSize)),o.left=n.width*(r?0:.1),o.top=h(.5*n.height,.75*n.height),o.width=n.width-2*o.left,o.height=h(.5*n.height,.25*n.height),o.horizontalAlign="center",o.verticalAlign="top"}else"v5"===e&&(l.left=0,l.top=0,l.width=n.width,l.height=h(.7*n.height,.725*n.height),l.verticalAlign="middle")},h});