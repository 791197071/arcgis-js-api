// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.31/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/keys","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dijit/Destroyable","esri/dijit/geoenrichment/utils/DelayUtil","esri/dijit/geoenrichment/utils/DeviceUtil","esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/MouseUtil","esri/dijit/geoenrichment/utils/animation/AnimationUtil","esri/dijit/geoenrichment/utils/mobile/GesturesUtil","../../../../ReportPlayerState"],function(e,i,t,n,o,d,l,r,a,s,c,u,m,h,D,g){return e(a,{ddZoomScreen:null,currentTriggerButtonBox:null,ddZoomScreenClass:null,closeZoomedDDWhenClickedOutside:!0,closeZoomedDDOnEsc:!0,zIndex:null,dataDrillingViewDiv:null,domNode:null,constructor:function(e){i.mixin(this,e),c.isMobileDevice()&&D.preventDefaultOverflow(this.dataDrillingViewDiv)},play:function(e,i,t,n){function d(e){e?(u.show(c.dataDrillingViewDiv),c.dataDrillingViewDiv.parentNode!==document.body&&document.body.appendChild(c.dataDrillingViewDiv),c.zIndex&&r.set(c.dataDrillingViewDiv,"zIndex",c.zIndex)):(c.dataDrillingViewDiv.parentNode===document.body&&document.body.removeChild(c.dataDrillingViewDiv),u.hide(c.dataDrillingViewDiv))}function a(){d(e),c._setZoomScreen(e,!1),c._setCloseHandlers(e),g.isViewingDataDrillingZoom=e,o[e?"add":"remove"](c.domNode,"isDrillingData"),o.remove(c.domNode,"isShowingAnimation")}var c=this;if(this.currentTriggerButtonBox=t?l.position(t):this.currentTriggerButtonBox,o.add(this.domNode,"isShowingAnimation"),o.add(this.dataDrillingViewDiv,"isZoomAnimation"),!i)return void a();d(!0);var m=this.getDataDrillingPanelDimensions(n);r.set(this.dataDrillingViewDiv,{width:m.w+"px",height:m.h+"px"}),this._setZoomScreen(e,!0);var D;if(e){var v=m.scale||1;D=h.animateResize({duration:200,domNode:this.dataDrillingViewDiv,fromBox:m.animateFromCenter?{x:0,y:0,w:document.body.clientWidth,h:document.body.clientHeight}:this.currentTriggerButtonBox,startScaleX:.7*v,startScaleY:.7*v,fromOffset:{x:"c",y:"c"},toBox:{x:(document.body.clientWidth-m.w*v)/2,y:(document.body.clientHeight-m.h*v)/2+(m.yOffset||0),w:m.w,h:m.h},endScaleX:m.scale,endScaleY:m.scale,onEnd:a}),h.animateFadeIn({domNode:c.dataDrillingViewDiv,duration:100})}else D=h.animateResize({duration:200,domNode:this.dataDrillingViewDiv,toBox:this.currentTriggerButtonBox,startScaleX:m.scale,startScaleY:m.scale,endScaleX:.7*(m.scale||1),endScaleY:.7*(m.scale||1),toOffset:{x:"c",y:"c"},onEnd:a}),h.animateFadeOut({domNode:this.dataDrillingViewDiv,duration:100});return D&&D.then(function(){return s.delay(100)})},_setZoomScreen:function(e,i){function t(){n.ddZoomScreen&&d.destroy(n.ddZoomScreen),n.ddZoomScreen=null}var n=this;e!==!!this.ddZoomScreen&&(e?(this.ddZoomScreen=d.create("div",{class:"esriGEAbsoluteStretched simpleInfographic_dataDrillingViewDivScreen"+(c.isMobileDevice()?" mobile":"")},this.dataDrillingViewDiv,"before"),c.isMobileDevice()&&D.preventDefaultOverflow(this.ddZoomScreen),this.zIndex&&r.set(this.ddZoomScreen,"zIndex",this.zIndex),this.ddZoomScreenClass&&o.add(this.ddZoomScreen,this.ddZoomScreenClass),i&&h.animateFadeIn({domNode:this.ddZoomScreen,duration:100})):i?h.animateFadeOut({domNode:this.ddZoomScreen,duration:100,onEnd:t}):t())},_clickOutsideHandler:null,_keyboardHandler:null,_setCloseHandlers:function(e){var i=this;this._clickOutsideHandler&&this._clickOutsideHandler.remove(),this._clickOutsideHandler=null,this._keyboardHandler&&this._keyboardHandler.remove(),this._keyboardHandler=null,e&&(this.closeZoomedDDWhenClickedOutside&&(this._clickOutsideHandler=t(document.body,c.press,function(){g.isViewingDynamicSettings||m.isMouseOver(i.dataDrillingViewDiv,{checkAllChildren:!0})||i.isMouseOver()||i.onExitDataDrilling()}),this.own(this._clickOutsideHandler)),this.closeZoomedDDOnEsc&&(this._keyboardHandler=t(document.body,"keyup",function(e){e.keyCode===n.ESCAPE&&i.onExitDataDrilling()}),this.own(this._keyboardHandler)))},isMouseOver:function(){return!1},getDataDrillingPanelDimensions:function(e){return null},onExitDataDrilling:function(){}})});