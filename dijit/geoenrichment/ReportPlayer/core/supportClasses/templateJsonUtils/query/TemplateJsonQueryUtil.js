// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.31/esri/copyright.txt for details.

define(["./_SectionJsonCollector","../../../infographics/InfographicTypes"],function(o,n){var e={},s="field",t={process:function(o,n,e,c,i){var r=c;c=function(o,n,e){o&&r.apply(this,arguments)};var a={processLevel:n,objJson:e,processFunc:c,ignoreComparisonCalculators:i&&i.ignoreComparisonCalculators};if(o===n&&(o!==s||n!==s))return void c(e);"document"===o?t._processTemplateJson(e,a):"section"===o?t._processSectionJson(e,a):"table"===o?t._processTableJson(e,a,null):"tableRow"===o?t._processTableDataObj(e,a,null):o===s&&t._processFieldInfo(e,a,null)},_processTemplateJson:function(n,e){n.sectionsTables?n.sectionsTables.forEach(function(o){t._processTableJson(o,e)}):o.collectSectionJsons(n,{saveParentInfo:!1,processFieldInfoFunc:function(o){e.processLevel===s&&e.processFunc(o)}}).forEach(function(o){t._processSectionJson(o,e)})},_processSectionJson:function(o,n){"section"===n.processLevel&&n.processFunc(o),o.stack&&o.stack.forEach(function(o){"sectionElement"===n.processLevel&&n.processFunc(o),"table"===o.id&&t._processTableJson(o,n)})},_processTableJson:function(o,n,e){"table"===n.processLevel&&n.processFunc(o),o.data.data.forEach(function(o){"tableRow"===n.processLevel&&n.processFunc(o,e),t._processTableDataObj(o,n,e)}),o.backgroundSectionJson&&t._processSectionJson(o.backgroundSectionJson,n),o.foregroundSectionJson&&t._processSectionJson(o.foregroundSectionJson,n),o.backgroundFloatingTablesSectionJson&&t._processSectionJson(o.backgroundFloatingTablesSectionJson,n),o.foregroundFloatingTablesSectionJson&&t._processSectionJson(o.foregroundFloatingTablesSectionJson,n)},_processTableDataObj:function(o,n,e){if(o.fieldInfos)for(var s in o.fieldInfos)t._processFieldInfo(o.fieldInfos[s],n,e,"tableCell")},_processFieldInfo:function(o,n,e,c){function i(o,e){n.processLevel===s&&n.processFunc(o,e,c)}o&&(i(o,e),function(o){o&&o.triggerJson&&o.triggerJson.fieldInfo&&o.templateName!==o.triggerJson.fieldInfo.templateName&&i(o.triggerJson.fieldInfo,o)}(o),o.linkFieldInfo&&i(o.linkFieldInfo,o),o.isRichText&&(o.richTextJson.fieldInfos.forEach(function(e){t._processFieldInfo(e,n,o,"richTextPart")}),o.richTextJson.specialFieldInfos.forEach(function(e){t._processFieldInfo(e,n,o,"richTextPart")})),o.isInfographic&&t._processInfographicFieldInfo(o,n),o.isChart&&t._processChartFieldInfo(o,n),o.isReportSection&&o.sectionJson&&t._processSectionJson(o.sectionJson,n))},_processInfographicFieldInfo:function(o,e){var s=o.infographicJson;switch(s.type){case n.STATIC:if(s.header&&t._processTableJson(s.header,e,o),s.variableTables&&s.variableTables.forEach(function(n){n.variable&&t._processFieldInfo(n.variable.fieldInfo,e,o,"staticInfographicVariable"),n.description&&n.description.fieldInfo&&t._processFieldInfo(n.description.fieldInfo,e,o,"staticInfographicDescription")}),s.dataDrilling)for(var c in s.dataDrilling){var i=s.dataDrilling[c];i&&i.sectionJson&&t._processSectionJson(i.sectionJson,e)}break;case n.AGE_PYRAMID:case n.TAPESTRY:case n.PRIZM5:case n.RELATED_VARS:case n.ONE_VAR:!e.ignoreComparisonCalculators&&s.fieldInfos&&s.fieldInfos.forEach(function(n){t._processFieldInfo(n,e,o,"dynamicInfographicVariable")});break;case n.AREA_DETAILS:s.titleSectionJson&&t._processSectionJson(s.titleSectionJson,e,o),s.attributesSectionJson&&t._processSectionJson(s.attributesSectionJson,e,o),s.notesSectionJson&&t._processSectionJson(s.notesSectionJson,e,o);break;case n.LOCATOR_TABLE:s.titleSectionJson&&t._processSectionJson(s.titleSectionJson,e),t._processSectionJson(s.headerSectionJson,e),t._processSectionJson(s.dataSectionJson,e),s.summarySectionJson&&t._processSectionJson(s.summarySectionJson,e),s.summaryFooterSectionJson&&t._processSectionJson(s.summaryFooterSectionJson,e);break;case n.COMPARISON_TABLE:s.titleSectionJson&&t._processSectionJson(s.titleSectionJson,e),e.ignoreComparisonCalculators||t._processSectionJson(s.dataSectionJson,e)}},_processChartFieldInfo:function(o,n){var e=o.chartJson.visualProperties;e.chartIcons&&e.chartIcons.forEach(function(e){t._processFieldInfo(e,n,o,"chartIcon")}),e.floatingIcons&&e.floatingIcons.forEach(function(e){t._processTableJson(e,n,o,"floatingIcon")}),e.floatingTexts&&e.floatingTexts.forEach(function(e){t._processTableJson(e,n,o,"floatingText")}),o.chartJson.seriesItems.forEach(function(e){e.points.forEach(function(e){n.ignoreComparisonCalculators&&o.chartJson.comparisonInfo||t._processFieldInfo(e.fieldInfo,n,o,"chartPointField"),e.iconFieldInfo&&t._processFieldInfo(e.iconFieldInfo,n,o,"chartPointIcon"),e.captionFieldInfo&&t._processFieldInfo(e.captionFieldInfo,n,o,"chartPointCaption")})})}};return e.DOCUMENT="document",e.SECTION="section",e.TABLE="table",e.SECTION_ELEMENT="sectionElement",e.TABLE_ROW="tableRow",e.FIELD=s,e.process=t.process,e.processTemplateFieldInfos=function(o,n,e){t.process("document",s,o,n,e)},e.processSectionFieldInfos=function(o,n,e){t.process("section",s,o,n,e)},e.processSectionElements=function(o,n){t.process("document","sectionElement",o,n)},e.processTableFieldInfos=function(o,n,e){t.process("table",s,o,n,e)},e.hasMultiFeatureChart=function(o){var n=!1;return e.processTemplateFieldInfos(o,function(o){o.isChart&&(n=n||o.chartJson&&!!o.chartJson.isMultiFeatureChart)}),n},e.hasComparisonInfographicTable=function(o){var s=!1;return e.processTemplateFieldInfos(o,function(o){o.isInfographic&&(s=s||o.infographicJson&&o.infographicJson.type===n.COMPARISON_TABLE)}),s},e.isGraphicReport=function(o){return!!o.sectionsTables},e.hasDynamicColumns=function(o){return e._checkTableAttributes(o,function(o){return o.dynamicColumns>0})},e.hasDynamicRows=function(o){return e._checkTableAttributes(o,function(o){return o.dynamicRows>0})},e._checkTableAttributes=function(o,n){var s;return e.isGraphicReport(o)?e.processTemplateFieldInfos(o,function(o){o.isReportSection&&o.sectionJson&&o.sectionJson.stack&&o.sectionJson.stack.some(function(o){if("table"===o.id&&o.attributes&&n(o.attributes))return s=!0,!0})}):s=e.collectSectionJsons(o).some(function(o){return o.stack&&o.stack.some(function(o){return"table"===o.id&&o.attributes&&n(o.attributes)})}),s},e.hasMultiFeatureSections=function(o){return!!e.isGraphicReport(o)&&(e.hasMultiFeatureChart(o)||e.hasDynamicColumns(o)||e.hasComparisonInfographicTable(o))},e.collectSectionJsons=o.collectSectionJsons,e.getParentBox=o.getParentBox,e.setParentBox=o.setParentBox,e.getParentStyle=o.getParentStyle,e});