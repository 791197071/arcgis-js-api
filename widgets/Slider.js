// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.12/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/assignHelper","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","dojo/i18n!./Slider/nls/Slider","../intl","../core/Evented","../core/events","../core/maybe","../core/accessorSupport/decorators","../core/libs/pep/pep","./Widget","./Slider/SliderViewModel","./support/widget"],function(e,t,n,i,o,r,a,s,l,u,c,h,d,p,m){var v={base:"esri-slider",horizontalLayout:"esri-slider--horizontal",verticalLayout:"esri-slider--vertical",contentElement:"esri-slider__content",extraContentElement:"esri-slider__extra-content",trackElement:"esri-slider__track",ticksContainerElement:"esri-slider__ticks",tickElement:"esri-slider__tick",tickLabelElement:"esri-slider__tick-label",maxElement:"esri-slider__max",minElement:"esri-slider__min",maxElementInteractive:"esri-slider__max--interactive",minElementInteractive:"esri-slider__min--interactive",rangeInput:"esri-slider__range-input",anchorElement:"esri-slider__anchor",movingAnchorElement:"esri-slider__anchor--moving",anchorElementIndexPrefix:"esri-slider__anchor-",segmentElement:"esri-slider__segment",segmentElementIndexPrefix:"esri-slider__segment-",segmentElementInteractive:"esri-slider__segment--interactive",thumbElement:"esri-slider__thumb",labelElement:"esri-slider__label",labelElementInteractive:"esri-slider__label--interactive",labelInput:"esri-slider__label-input",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},_={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"};return function(e){function t(t){var n=e.call(this)||this;return n._activeLabelInputIndex=null,n._anchorElements=null,n._dragged=!1,n._dragStartInfo=null,n._focusedAnchorIndex=null,n._isMinInputActive=!1,n._isMaxInputActive=!1,n._labelElements=[],n._segmentDragStartInfo=null,n._segmentElements=null,n._thumbElements=[],n._tickElements=[],n._trackHeight=null,n._trackWidth=null,n.extraNodes=[],n.draggableSegmentsEnabled=!0,n.label=r.widgetLabel,n.labelFormatFunction=null,n.labelInputsEnabled=!1,n.labels=null,n.labelsVisible=!1,n.max=null,n.min=null,n.precision=4,n.rangeLabelInputsEnabled=!1,n.rangeLabelsVisible=!1,n.snapOnClickEnabled=!0,n.steps=null,n.thumbCreatedFunction=null,n.tickConfigs=null,n.trackElement=null,n.values=null,n.viewModel=new p,n._onAnchorPointerDown=n._onAnchorPointerDown.bind(n),n._onAnchorPointerMove=n._onAnchorPointerMove.bind(n),n._onAnchorPointerUp=n._onAnchorPointerUp.bind(n),n._onLabelPointerDown=n._onLabelPointerDown.bind(n),n._onLabelPointerUp=n._onLabelPointerUp.bind(n),n._onSegmentPointerDown=n._onSegmentPointerDown.bind(n),n._onSegmentPointerMove=n._onSegmentPointerMove.bind(n),n._onSegmentPointerUp=n._onSegmentPointerUp.bind(n),n._onTrackPointerDown=n._onTrackPointerDown.bind(n),n}return i(t,e),Object.defineProperty(t.prototype,"layout",{set:function(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){var e=this,t=e._activeLabelInputIndex,n=e._isMaxInputActive,i=e._isMinInputActive,o=e._dragStartInfo,r=e._segmentDragStartInfo,a=e.viewModel,s=u.isSome(o)||u.isSome(r);return null===t&&!n&&!i?s?"dragging":a.state:"editing"},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this,t=e.label,n=e.layout,i=e.state,o=e.trackElement,r=this.classes(v.base,v.esriWidget,"horizontal"===n?v.horizontalLayout:v.verticalLayout,"disabled"===i?v.disabled:null);return o&&(this._trackHeight=o.offsetHeight,this._trackWidth=o.offsetWidth),m.tsx("div",{"aria-label":t,class:r,"touch-action":"none"},"disabled"!==i?this.renderContent():null)},t.prototype.renderContent=function(){return this.rangeLabelsVisible?[this.renderMin(),this.renderSliderContainer(),this.renderMax()]:this.renderSliderContainer()},t.prototype.renderSliderContainer=function(){return m.tsx("div",{bind:this,class:v.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())},t.prototype.renderTrackElement=function(){return m.tsx("div",{afterCreate:this._afterTrackCreate,bind:this,class:v.trackElement,"data-node-ref":"trackElement","touch-action":"none"},this.renderSegmentElements(),this.renderAnchorElements())},t.prototype.renderSegmentElements=function(){if(this.trackElement&&this.values&&this.values.length){this._segmentElements=[];for(var e=this.values.length+1,t=[],n=0;n<e;n++)t.push(this.renderSegmentElement(n));return t}},t.prototype.renderSegmentElement=function(e){var t=this,n=t._trackHeight,i=t._trackWidth,o=t.draggableSegmentsEnabled,r=t.layout,a=t.values,s="horizontal"===r,l=s?i:n,c=e===a.length?null:e,h=u.isSome(c),d=0===e?null:e-1,p=u.isSome(d),_=h?this._calculatePositionFromValue(a[c]):s?l:0,f=p?this._calculatePositionFromValue(a[d]):s?0:l,g=parseFloat((100*f/l).toFixed(5)),b=(_-f)/l,y=s?"transform: translate("+g+"%, 0px) scale("+b+", 1);":"transform: translate(0px, "+g+"%) scale(1, "+b+");",x=this.classes(v.segmentElement,v.segmentElementIndexPrefix+e,o&&h&&p?v.segmentElementInteractive:null);return m.tsx("div",{afterCreate:this._afterSegmentCreate,bind:this,class:x,"data-max-thumb-index":c,"data-min-thumb-index":d,"data-segment-index":e,style:y,"touch-action":"none"})},t.prototype.renderAnchorElements=function(){var e=this,t=this,n=t.trackElement,i=t.values;return this._anchorElements=[],this._thumbElements=[],this._labelElements=[],n&&i&&i.length?i.map(function(t,n){return e.renderAnchorElement(t,n)}):null},t.prototype.renderAnchorElement=function(e,t){var n=this._calculatePositionFromValue(e),i=this._calculateValueFromPosition(n);if(u.isSome(i)&&!isNaN(i)){var o=this,s=o._dragStartInfo,l=o.id,c=o.labelsVisible,h=o.layout,d=o.values,p=s&&s.index===t,_=this.classes(v.anchorElement,v.anchorElementIndexPrefix+t,p?v.movingAnchorElement:null),f=this.labels.values[t],g=this._calculatePositionStyleForElement(e),b=this._calculateValueBoundsForAnchor(t),y=b[0],x=b[1],E=2===d.length?0===t?a.substitute(r.rangeMinimum,{value:e}):a.substitute(r.rangeMaximum,{value:e}):f,I=1===d.length?null:0===t?l+"-handle-"+(t+1):t===d.length-1?l+"-handle-"+(t-1):l+"-handle-"+(t-1)+" "+l+"-handle-"+(t+1);return m.tsx("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,"aria-controls":I,"aria-label":r.sliderValue,"aria-labelledby":c?l+"-label-"+t:null,"aria-orientation":h,"aria-valuemax":y.toString(),"aria-valuemin":x.toString(),"aria-valuenow":e.toString(),"aria-valuetext":E,bind:this,class:_,"data-thumb-index":t,"data-value":e,id:l+"-handle-"+t,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:g,tabIndex:0},m.tsx("span",{afterCreate:this._afterThumbCreate,bind:this,class:v.thumbElement,"data-thumb-index":t,"touch-action":"none"}),c?this.renderThumbLabel(t):null)}},t.prototype.renderThumbLabel=function(e){var t=this,n=t.id,i=t.labels,o=i.values[e],r=this.classes(v.labelElement,this.labelInputsEnabled?v.labelElementInteractive:null);return m.tsx("span",{afterCreate:this._afterLabelCreate,bind:this,class:r,"data-thumb-index":e,id:n+"-label-"+e,role:this.labelInputsEnabled?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):o)},t.prototype.renderValueInput=function(e){var t=this.values[e];return m.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":r.sliderValue,bind:this,class:v.labelInput,required:!0,tabIndex:0,type:"text",value:t.toString(),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})},t.prototype.renderMax=function(){var e=this,t=e._isMaxInputActive,n=e.labels,i=this.classes(v.maxElement,this.rangeLabelInputsEnabled?v.maxElementInteractive:null);return m.tsx("div",{bind:this,class:i,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:this.rangeLabelInputsEnabled?"button":null,tabIndex:this.rangeLabelInputsEnabled?0:null},t?this.renderMaxInput():n.max)},t.prototype.renderMin=function(){var e=this,t=e._isMinInputActive,n=e.labels,i=this.classes(v.minElement,this.rangeLabelInputsEnabled?v.minElementInteractive:null);return m.tsx("div",{bind:this,class:i,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:this.rangeLabelInputsEnabled?"button":null,tabIndex:this.rangeLabelInputsEnabled?0:null},t?this.renderMinInput():n.min)},t.prototype.renderMaxInput=function(){return m.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":r.maximumValue,bind:this,class:v.rangeInput,required:!0,tabIndex:0,type:"text",value:this.max.toString(),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})},t.prototype.renderMinInput=function(){return m.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":r.minimumValue,bind:this,class:v.rangeInput,required:!0,tabIndex:0,type:"text",value:this.min.toString(),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})},t.prototype.renderExtraContentElements=function(){return m.tsx("div",{bind:this,class:v.extraContentElement},this.extraNodes)},t.prototype.renderTicksContainer=function(){var e=this;if(this.tickConfigs&&this.trackElement)return this.tickConfigs.map(function(t,n){return m.tsx("div",{key:"ticks-container",class:e.classes(v.ticksContainerElement)},e.renderTicks(t,n))})},t.prototype.renderTicks=function(e,t){var n=this,i=e.mode,o=e.values;if(this._tickElements[t]=[],"position"===i){var r=Array.isArray(o)?o:[o];return this._calculateTickPositions(r).map(function(i,o){return n.renderTickGroup(e,o,t,i)})}if("percent"===i&&Array.isArray(o)){var a=this,s=a.max,l=a.min,u=s-l,c=o.map(function(e){return parseFloat((e/100*u+l).toFixed(5))});return this._calculateTickPositions(c).map(function(i,o){return n.renderTickGroup(e,o,t,i)})}var h=Array.isArray(o)&&o.length?o[0]:isNaN(o)?null:o,d=this._getTickCounts(h,e);return this._calculateEquidistantTickPositions(d).map(function(i,o){return n.renderTickGroup(e,o,t,i)})},t.prototype.renderTickGroup=function(e,t,n,i){var o="position"===e.mode?Array.isArray(e.values)?e.values[t]:e.values:this._calculateValueFromPosition(i);if(u.isSome(o)&&!isNaN(o))return m.tsx("div",{afterCreate:this._afterTickGroupCreate,bind:this,"data-config":e,"data-position":i,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":o,key:"tick-group-"+t},this.renderTickLine(e,t,n,o,i),e.labelsVisible?this.renderTickLabel(e,t,n,o,i):null)},t.prototype.renderTickLine=function(e,t,n,i,o){return m.tsx("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":i.toString(),bind:this,class:v.tickElement,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":i,key:"tick-label-"+t,style:this._calculatePositionStyleForElement(i)})},t.prototype.renderTickLabel=function(e,t,n,i,o){var r=e.labelFormatFunction?e.labelFormatFunction(i,"tick",t):this.viewModel.getLabelForValue(i,"tick",t);return m.tsx("div",{afterCreate:this._afterTickLabelCreate,"aria-label":r,"aria-valuenow":i.toString(),"aria-valuetext":r,bind:this,class:v.tickLabelElement,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":i,key:"tick-label-"+t,style:"transform: translate(-50%); "+this._calculatePositionStyleForElement(i)},r)},t.prototype._afterTrackCreate=function(e){m.storeNode.call(this,e),h.applyLocal(e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()},t.prototype._afterSegmentCreate=function(e){this._segmentElements.push(e),h.applyLocal(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)},t.prototype._afterAnchorCreate=function(e){if(this._anchorElements.push(e),h.applyLocal(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){var t=e["data-thumb-index"],n=e["data-value"],i=this._thumbElements[t]||null,o=this._labelElements[t]||null;this.thumbCreatedFunction(t,n,i,o)}},t.prototype._afterAnchorUpdate=function(e){if(this._anchorElements.push(e),u.isSome(this._focusedAnchorIndex)){e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}},t.prototype._afterThumbCreate=function(e){this._thumbElements.push(e)},t.prototype._afterLabelCreate=function(e){this._labelElements.push(e),h.applyLocal(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)},t.prototype._afterInputCreate=function(e){e.focus(),e.select()},t.prototype._afterTickLineCreate=function(e){var t=e["data-tick-config-index"],n=e["data-tick-group-index"],i=this._tickElements[t];i[n]?i[n].line=e:i[n]={line:e,label:null}},t.prototype._afterTickLabelCreate=function(e){var t=e["data-tick-config-index"],n=e["data-tick-group-index"],i=this._tickElements[t];i[n]?i[n].label=e:i[n]={label:e,line:null}},t.prototype._afterTickGroupCreate=function(e){var t=e["data-config"];if(t&&t.tickCreatedFunction){var n=e["data-tick-config-index"],i=e["data-tick-group-index"],o=e["data-value"],r=this._tickElements[n][i];if(r){var a=r.line||null,s=r.label||null;t.tickCreatedFunction(o,a,s)}}},t.prototype._onAnchorKeyDown=function(e){if("editing"!==this.state){var t=e.target,n=l.eventKey(e),i=this,o=i._anchorElements,r=i.layout,a=i.values,s=t["data-thumb-index"],u=o[s],c=a[s],h="horizontal"===r,d=[_.moveAnchorUp,_.moveAnchorDown,_.moveAnchorLeft,_.moveAnchorRight];if(n===_.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=s,this.notifyChange("state");else if(d.indexOf(n)>-1){e.preventDefault();var p=h?u.offsetLeft:u.offsetTop,m=n===_.moveAnchorUp||n===_.moveAnchorRight?1:-1,v=this._calculatePositionAfterMovementKeyPress(s,p,m);this._setAnchorPosition(s,v);var f=a[s];this._emitThumbChangeEvent({index:s,oldValue:c,value:f})}else if(n===_.moveAnchorToMax||n===_.moveAnchorToMin){e.preventDefault();var g=this._calculatePixelBoundsForAnchor(s),b=g[0],y=g[1],v=h?n===_.moveAnchorToMax?b:y:n===_.moveAnchorToMin?b:y;this._setAnchorPosition(s,v);var f=a[s];this._emitThumbChangeEvent({index:s,oldValue:c,value:f})}}},t.prototype._onTrackPointerDown=function(e){var t=this,n=t._dragStartInfo,i=t.snapOnClickEnabled,o=t.state,r=t.values;if("editing"!==o&&!n&&i&&r.length){var a=this,s=a.layout,l=a.steps,c=e.clientX,h=e.clientY,d=this.trackElement.getBoundingClientRect(),p=e.clientX-d.left,m=e.clientY-d.top,v="horizontal"===s?p:m,_=this._calculateValueFromPosition(v),f=this._getIndexOfNearestValue(_);if(!u.isSome(f))return;var g=r[f],b=u.isSome(l)?this._calculateNearestStepPosition(v):v;this._setAnchorPosition(f,b),this._dragged=!0,this._dragStartInfo={clientX:c,clientY:h,index:f,position:b},this._focusedAnchorIndex=f,this.notifyChange("state"),this._emitThumbDragEvent({index:f,state:"start",value:g}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}},t.prototype._onSegmentPointerDown=function(e){var t=this,n=t._anchorElements,i=t.draggableSegmentsEnabled,o=e.target,r=o["data-segment-index"],a=o["data-max-thumb-index"],s=o["data-min-thumb-index"];if(i&&u.isSome(s)&&u.isSome(a)){e.stopPropagation();var l=[s,a];this._segmentDragStartInfo={index:r,thumbIndices:l,clientX:e.x,clientY:e.y,maxPosition:this._getAnchorPosition(n[a]),minPosition:this._getAnchorPosition(n[s])},this.notifyChange("state"),this._emitSegmentDragEvent({index:r,state:"start",thumbIndices:l}),document.addEventListener("pointerup",this._onSegmentPointerUp),document.addEventListener("pointermove",this._onSegmentPointerMove)}},t.prototype._onSegmentPointerMove=function(e){if(this._segmentDragStartInfo){e.preventDefault();var t=this,n=t.layout,i=t._segmentDragStartInfo,o=i.clientX,r=i.clientY,a=i.index,s=i.thumbIndices,l=s[0],u=s[1],c=i.maxPosition,h=i.minPosition;this._dragged=!0;var d="horizontal"===n?e.clientX-o:e.clientY-r,p=c+d,m=h+d,v=this._calculatePixelBoundsForAnchor(u),_=this._calculatePixelBoundsForAnchor(l);if(m<_[1])return void this._setAnchorPositions([l,u],[_[1],c-(h-_[1])]);if(p>v[0])return void this._setAnchorPositions([l,u],[h-(c-v[0]),v[0]]);var f=this._anchorElements,g=f[u],b=f[l],y=this._getAnchorPosition(g),x=this._getAnchorPosition(b);if(y!==p&&x!==m){var E=this.values,I=[E[l],E[u]];this._setAnchorPositions([l,u],[m,p]);![E[l],E[u]].every(function(e,t){return e===I[t]})&&this._emitSegmentDragEvent({index:a,state:"drag",thumbIndices:[l,u]})}}},t.prototype._onSegmentPointerUp=function(e){if(document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),this._segmentDragStartInfo){var t=this._segmentDragStartInfo,n=t.index,i=t.thumbIndices;this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this.scheduleRender(),this._emitSegmentDragEvent({index:n,state:"stop",thumbIndices:i})}},t.prototype._onAnchorPointerDown=function(e){var t=e.target,n=e.clientX,i=e.clientY,o=t["data-thumb-index"];if(void 0!==o){var r=this._anchorElements[o],a=r.offsetTop,s=r.offsetLeft;this._dragStartInfo={clientX:n,clientY:i,index:o,position:"horizontal"===this.layout?s:a},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}},t.prototype._onAnchorPointerMove=function(e){if("editing"!==this.state&&this._dragStartInfo){var t=this,n=t.layout,i=t.values,o=t._anchorElements,r=t._dragged,a=t._dragStartInfo,s=t._dragStartInfo,l=s.index,u=s.position,c=e.clientX,h=e.clientY,d=r?"drag":"start",p=o[l],m=this._getAnchorPosition(p),v="horizontal"===n?u+c-a.clientX:u+h-a.clientY;if(m!==v){var _=i[l];this._dragged=!0,this._setAnchorPosition(l,v);var f=this.values[l];r?_!==f&&this._emitThumbDragEvent({index:l,state:d,value:f}):this._emitThumbDragEvent({index:l,state:d,value:_})}}},t.prototype._onAnchorPointerUp=function(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this._dragStartInfo){var t=this._dragStartInfo.index,n=this._dragged;this._dragged=!1,this._dragStartInfo=null,n?(this.notifyChange("state"),this.scheduleRender(),this._emitThumbDragEvent({index:t,state:"stop",value:this.values[t]})):this.scheduleRender()}},t.prototype._onLabelPointerDown=function(e){document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)},t.prototype._onLabelPointerMove=function(e){this._dragged=!0},t.prototype._onLabelPointerUp=function(e){var t=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&u.isSome(t)&&(this._activeLabelInputIndex=t,this.notifyChange("state")),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)},t.prototype._onLabelInputBlur=function(e){var t=this,n=t._activeLabelInputIndex,i=t.values,o=t.viewModel,r=e.target,a=r.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),a){var s=this._applyPrecisionToValue(parseFloat(a)),l=i[n],u=this._calculateValueBoundsForAnchor(n),c=u[0],h=u[1];!isNaN(s)&&s<=c&&s>=h&&l!==s&&(o.setValue(n,s),this._emitValueChangeEvent({index:n,oldValue:l,value:s}),this._emitThumbChangeEvent({index:n,oldValue:l,value:s}))}},t.prototype._onMaxLabelClick=function(e){this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state"))},t.prototype._onMaxLabelKeyDown=function(e){l.eventKey(e)===_.showInput&&(this._isMaxInputActive=!0,this.notifyChange("state"))},t.prototype._onMaxInputBlur=function(e){var t=e.target,n=t.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),n){var i=this.max;this.viewModel.set("max",this._applyPrecisionToValue(parseFloat(n))),this.max!==i&&this._emitMaxChangeEvent({oldValue:i,value:this.max})}},t.prototype._onMinLabelClick=function(e){this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state"))},t.prototype._onMinLabelKeyDown=function(e){l.eventKey(e)===_.showInput&&(this._isMinInputActive=!0,this.notifyChange("state"))},t.prototype._onMinInputBlur=function(){var e=event.target,t=e.value;if(this._isMinInputActive=!1,this.notifyChange("state"),t){var n=this.min;this.viewModel.set("min",this._applyPrecisionToValue(parseFloat(t))),this.min!==n&&this._emitMinChangeEvent({oldValue:n,value:this.min})}},t.prototype._onInputKeyDown=function(e){var t=e.target,n=l.eventKey(e),i=_.hideInput1,o=_.hideInput2,r=_.hideInput3,a=this,s=a._activeLabelInputIndex,c=a._anchorElements,h=t;if(n===i||n===o||n===r){e.stopPropagation();var d=s;h.blur(),u.isSome(d)?c[d].focus():h.parentElement.focus()}},t.prototype._applyPrecisionToValue=function(e){return parseFloat(e.toFixed(this.precision))},t.prototype._calculatePositionFromValue=function(e){var t=this,n=t._trackHeight,i=t._trackWidth,o=t.layout,r=t.max,a=t.min,s=r-a;return"horizontal"===o?parseFloat((i*(e-a)/s).toFixed(2)):parseFloat((n*(r-e)/s).toFixed(2))},t.prototype._calculateValueFromPosition=function(e){var t=this,n=t._trackHeight,i=t._trackWidth,o=t.layout,r=t.max,a=t.min,s=t.precision,l=r-a,u="horizontal"===o?e*l/i+a:l*(1e3-e/n*1e3)/1e3+a;return parseFloat(u.toFixed(s))},t.prototype._getAnchorPosition=function(e){return"horizontal"===this.layout?e.offsetLeft:e.offsetTop},t.prototype._setAnchorPositions=function(e,t){var n=this,i=this.values;if(e&&0!==e.length){if(1===e.length){var o=e[0],r=i[o];this._setAnchorPosition(o,t[0]);var a=i[o];return void(a!==r&&this._emitValueChangeEvent({index:o,oldValue:r,value:a}))}for(var s=e.map(function(e){return i[e]}),l=0;l<e.length;l++)this._setAnchorPosition(e[l],t[l],!0);var u=e.map(function(e){return n.values[e]});!u.every(function(e,t){return e===s[t]})&&this._emitValuesChangeEvent({indices:e,oldValues:s,values:u})}},t.prototype._setAnchorPosition=function(e,t,n){var i=this,o=i.steps,r=i.values,a=r[e];u.isSome(o)&&(t=this._calculateNearestStepPosition(t));var s=this._calculateValueBoundsForAnchor(e),l=s[0],c=s[1],h=this._calculatePixelBoundsForAnchor(e),d=h[0],p=h[1],m=Math.max(Math.min(t,d),p),v=this._calculateValueFromPosition(m),_=Math.max(Math.min(v,l),c),f=this._calculatePositionStyleForElement(_),g=this,b=g._anchorElements,y=g.layout,x=g.viewModel,E=b[e];"horizontal"===y?E.style.left=""+f:E.style.top=""+f,x.setValue(e,_);var I=this.values[e];a===I||n||this._emitValueChangeEvent({index:e,oldValue:a,value:I})},t.prototype._calculateValueBoundsForAnchor=function(e){var t=this,n=t.max,i=t.min,o=t.values;return[u.isSome(o[e+1])?o[e+1]:n,u.isSome(o[e-1])?o[e-1]:i]},t.prototype._calculatePixelBoundsForAnchor=function(e){var t,n,i=this,o=i._anchorElements,r=i._trackHeight,a=i._trackWidth,s=i.layout,l=o[e-1],u=o[e+1];return"horizontal"===s?(t=u?u.offsetLeft:a,n=l?l.offsetLeft:0):(t=l?l.offsetTop:r,n=u?u.offsetTop:0),[t,n]},t.prototype._getIndexOfNearestValue=function(e){var t=this.values,n=t.reduce(function(t,n){return Math.abs(n-e)<Math.abs(t-e)?n:t});return t.indexOf(n)},t.prototype._getIndexOfNearestStepValue=function(e){var t=this.steps;if(!u.isSome(t))return null;var n=this._getStepValues(),i=n.reduce(function(t,n){return Math.abs(n-e)<Math.abs(t-e)?n:t});return n.indexOf(i)},t.prototype._calculateNearestStepPosition=function(e){var t=this._calculateValueFromPosition(e),n=this._getIndexOfNearestStepValue(t),i=this._getStepValues();return this._calculatePositionFromValue(i[n])},t.prototype._getStepValues=function(){var e=this.steps;if(Array.isArray(e))return e;for(var t=this,n=t.max,i=t.min,o=Math.ceil((n-i)/e),r=[],a=0;a<=o;a++){var s=i+e*a;r.push(s>n?n:s)}return r},t.prototype._calculatePositionAfterMovementKeyPress=function(e,t,n){var i=this,o=i.steps,r=i.values,a=r[e];if(u.isSome(o))return this._calculateStepPositionAfterMovementKeyPress(a,n);var s=this,l=s.layout,c=s.precision,h="horizontal"===l?n:-1*n,d=t+h;return 0===c?this._calculatePositionFromValue(this._calculateValueFromPosition(d)+h):d},t.prototype._calculateStepPositionAfterMovementKeyPress=function(e,t){var n=this._getStepValues(),i=n.indexOf(e);if(i>-1)return this._calculatePositionFromValue(u.isSome(n[i+t])?n[i+t]:n[i]);var o=this._getIndexOfNearestStepValue(e+1e-4*t);return this._calculatePositionFromValue(n[o+t])},t.prototype._getTickCounts=function(e,t){var n=t.mode;return"count"===n||"position"===n?e||0:"percent"===n?100/e||0:0},t.prototype._calculateTickPositions=function(e){var t=this;return e.map(function(e){return t._calculatePositionFromValue(e)})},t.prototype._calculateEquidistantTickPositions=function(e){var t=this,n=t._trackWidth,i=t._trackHeight,o=t.layout,r="horizontal"===o?n:i,a=r/(e-1),s=[];if(1===e)return[r/2];for(var l=0;l<e;l++){var u=l*a;u<=r&&s.push(u)}return s},t.prototype._calculatePositionStyleForElement=function(e){var t=this._calculatePositionForElement(e);return("horizontal"===this.layout?"left":"top")+": "+t},t.prototype._calculatePositionForElement=function(e){var t=this,n=t.layout,i=t.max,o=t.min,r=i-o,a=(e-o)/r*100;return("horizontal"===n?a:100-a)+"%"},t.prototype._emitMaxChangeEvent=function(e){this.emit("max-change",n({},e,{type:"max-change"}))},t.prototype._emitMinChangeEvent=function(e){this.emit("min-change",n({},e,{type:"min-change"}))},t.prototype._emitValueChangeEvent=function(e){this.emit("value-change",n({},e,{type:"value-change"}))},t.prototype._emitValuesChangeEvent=function(e){this.emit("values-change",n({},e,{type:"values-change"}))},t.prototype._emitThumbChangeEvent=function(e){this.emit("thumb-change",n({},e,{type:"thumb-change"}))},t.prototype._emitThumbDragEvent=function(e){this.emit("thumb-drag",n({},e,{type:"thumb-drag"}))},t.prototype._emitSegmentDragEvent=function(e){this.emit("segment-drag",n({},e,{type:"segment-drag"}))},o([c.property()],t.prototype,"extraNodes",void 0),o([c.property(),m.renderable()],t.prototype,"draggableSegmentsEnabled",void 0),o([c.property()],t.prototype,"label",void 0),o([c.aliasOf("viewModel.labelFormatFunction")],t.prototype,"labelFormatFunction",void 0),o([c.property()],t.prototype,"labelInputsEnabled",void 0),o([c.aliasOf("viewModel.labels")],t.prototype,"labels",void 0),o([c.property(),m.renderable()],t.prototype,"labelsVisible",void 0),o([c.property({value:"horizontal"}),m.renderable()],t.prototype,"layout",null),o([c.aliasOf("viewModel.max")],t.prototype,"max",void 0),o([c.aliasOf("viewModel.min")],t.prototype,"min",void 0),o([c.aliasOf("viewModel.precision")],t.prototype,"precision",void 0),o([c.property()],t.prototype,"rangeLabelInputsEnabled",void 0),o([c.property(),m.renderable()],t.prototype,"rangeLabelsVisible",void 0),o([c.property()],t.prototype,"snapOnClickEnabled",void 0),o([c.property({dependsOn:["viewModel.state"],readOnly:!0})],t.prototype,"state",null),o([c.property()],t.prototype,"steps",void 0),o([c.property()],t.prototype,"thumbCreatedFunction",void 0),o([c.property()],t.prototype,"tickConfigs",void 0),o([c.property()],t.prototype,"trackElement",void 0),o([c.aliasOf("viewModel.values")],t.prototype,"values",void 0),o([c.property(),m.renderable(["viewModel.max","viewModel.min","viewModel.precision","viewModel.labelFormatFunction","viewModel.labels","viewModel.values"])],t.prototype,"viewModel",void 0),t=o([c.subclass("esri.widgets.Slider")],t)}(c.declared(d,s))});