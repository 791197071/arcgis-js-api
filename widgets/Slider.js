// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/next/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/assignHelper","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","dojo/i18n!./Slider/nls/Slider","../intl","../core/events","../core/Logger","../core/maybe","../core/accessorSupport/decorators","../core/libs/pep/pep","../libs/resize-observer/ResizeObserver","./Widget","./Slider/SliderViewModel","./support/widget"],function(e,t,n,i,o,r,a,s,l,u,h,d,p,c,m,_){var v={base:"esri-slider",reversed:"esri-slider--reversed",horizontalLayout:"esri-slider--horizontal",verticalLayout:"esri-slider--vertical",contentElement:"esri-slider__content",extraContentElement:"esri-slider__extra-content",trackElement:"esri-slider__track",ticksContainerElement:"esri-slider__ticks",tickElement:"esri-slider__tick",tickLabelElement:"esri-slider__tick-label",maxElement:"esri-slider__max",minElement:"esri-slider__min",maxElementInteractive:"esri-slider__max--interactive",minElementInteractive:"esri-slider__min--interactive",rangeInput:"esri-slider__range-input",anchorElement:"esri-slider__anchor",movingAnchorElement:"esri-slider__anchor--moving",lastMovedAnchorElement:"esri-slider__anchor--moved",anchorElementIndexPrefix:"esri-slider__anchor-",segmentElement:"esri-slider__segment",segmentElementIndexPrefix:"esri-slider__segment-",segmentElementInteractive:"esri-slider__segment--interactive",thumbElement:"esri-slider__thumb",labelElement:"esri-slider__label",labelElementInteractive:"esri-slider__label--interactive",labelInput:"esri-slider__label-input",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},g={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},f=l.getLogger("esri.widgets.Slider");return function(e){function t(t){var n=e.call(this)||this;return n._activeLabelInputIndex=null,n._anchorElements=null,n._baseNode=null,n._dragged=!1,n._dragStartInfo=null,n._focusedAnchorIndex=null,n._isMinInputActive=!1,n._isMaxInputActive=!1,n._labelElements=[],n._lastMovedHandleIndex=null,n._observer=null,n._positionPrecision=5,n._segmentDragStartInfo=null,n._segmentElements=null,n._thumbElements=[],n._tickElements=[],n._trackHeight=null,n._trackWidth=null,n._zIndices=null,n._zIndexOffset=3,n.disabled=!1,n.extraNodes=[],n.draggableSegmentsEnabled=!0,n.label=r.widgetLabel,n.labelFormatFunction=null,n.inputFormatFunction=null,n.inputParseFunction=null,n.labelInputsEnabled=!1,n.labels=null,n.labelsVisible=!1,n.max=null,n.min=null,n.precision=4,n.rangeLabelInputsEnabled=!1,n.rangeLabelsVisible=!1,n.snapOnClickEnabled=!0,n.steps=null,n.thumbsConstrained=!0,n.thumbCreatedFunction=null,n.tickConfigs=null,n.trackElement=null,n.values=null,n.viewModel=new m,n._observer=new p(function(){return n.scheduleRender()}),n._onAnchorPointerDown=n._onAnchorPointerDown.bind(n),n._onAnchorPointerMove=n._onAnchorPointerMove.bind(n),n._onAnchorPointerUp=n._onAnchorPointerUp.bind(n),n._onLabelPointerDown=n._onLabelPointerDown.bind(n),n._onLabelPointerUp=n._onLabelPointerUp.bind(n),n._onSegmentPointerDown=n._onSegmentPointerDown.bind(n),n._onSegmentPointerMove=n._onSegmentPointerMove.bind(n),n._onSegmentPointerUp=n._onSegmentPointerUp.bind(n),n._onTrackPointerDown=n._onTrackPointerDown.bind(n),n}return i(t,e),Object.defineProperty(t.prototype,"layout",{set:function(e){-1===["vertical","vertical-reversed","horizontal","horizontal-reversed"].indexOf(e)&&(e="horizontal"),this._set("layout",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){var e=this,t=e._activeLabelInputIndex,n=e._isMaxInputActive,i=e._isMinInputActive,o=e._dragStartInfo,r=e._segmentDragStartInfo,a=e.viewModel,s=u.isSome(o)||u.isSome(r);return null===t&&!n&&!i?s?"dragging":a.state:"editing"},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this.label,t=this.classes(v.base,v.esriWidget,this._isHorizontalLayout()?v.horizontalLayout:v.verticalLayout,this._isReversedLayout()?v.reversed:null,this._isDisabled()?v.disabled:null);return this._storeTrackDimensions(),_.tsx("div",{afterCreate:this._afterBaseNodeCreate,bind:this,"aria-label":e,class:t,"touch-action":"none"},this.renderContent())},t.prototype.toNextStep=function(e){this._toStep(e,1)},t.prototype.toPreviousStep=function(e){this._toStep(e,-1)},t.prototype.renderContent=function(){return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]},t.prototype.renderSliderContainer=function(){if(u.isSome(this.min)&&u.isSome(this.max))return _.tsx("div",{key:"slider-container",bind:this,class:v.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())},t.prototype.renderTrackElement=function(){return _.tsx("div",{afterCreate:this._afterTrackCreate,bind:this,class:v.trackElement,"data-node-ref":"trackElement","touch-action":"none"},this.renderSegmentElements(),this.renderAnchorElements())},t.prototype.renderSegmentElements=function(){if(this.trackElement&&this.values&&this.values.length){this._segmentElements=[];for(var e=this.values.length+1,t=[],n=0;n<e;n++)t.push(this.renderSegmentElement(n));return t}},t.prototype.renderSegmentElement=function(e){var t,n,i=this,o=i._trackHeight,r=i._trackWidth,a=i.draggableSegmentsEnabled,s=i.state,l=i.values,h=this._isHorizontalLayout(),d=h?r:o,p=e===l.length?null:e,c=0===e?null:e-1,m=u.isSome(p),g=u.isSome(c),f=l.slice().sort(function(e,t){return e-t});this._isReversedLayout()?(t=g?this._positionFromValue(f[c]):h?d:0,n=m?this._positionFromValue(f[p]):h?0:d):(t=m?this._positionFromValue(f[p]):h?d:0,n=g?this._positionFromValue(f[c]):h?0:d);var b=this._applyPrecisionToPosition(100*n/d),y=(t-n)/d,x=h?"transform: translate("+b+"%, 0px) scale("+y+", 1);":"transform: translate(0px, "+b+"%) scale(1, "+y+");",E=this.classes(v.segmentElement,v.segmentElementIndexPrefix+e,a&&m&&g&&"disabled"!==s?v.segmentElementInteractive:null);return _.tsx("div",{afterCreate:this._afterSegmentCreate,bind:this,class:E,"data-max-thumb-index":p,"data-min-thumb-index":c,"data-segment-index":e,style:x,"touch-action":"none"})},t.prototype.renderAnchorElements=function(){var e=this,t=this,n=t.trackElement,i=t.values;if(i&&i.length)return this._anchorElements=[],this._thumbElements=[],this._labelElements=[],this._zIndices=i.map(function(t,n){var o=e._positionFromValue(t),r=e._positionToPercent(o),a=e._isHorizontalLayout()?r>50:r<50,s=a?-1:1;return e._zIndexOffset+(i.length+s*n)}),n&&i&&i.length?i.map(function(t,n){return e.renderAnchorElement(t,n)}):null},t.prototype.renderAnchorElement=function(e,t){var n=this._positionFromValue(e),i=this._valueFromPosition(n);if(u.isSome(i)&&!isNaN(i)){var o=this,s=o._dragStartInfo,l=o._lastMovedHandleIndex,h=o.id,d=o.labelsVisible,p=o.layout,c=o.values,m=s&&s.index===t,g=l===t,f=this.classes(v.anchorElement,v.anchorElementIndexPrefix+t,m?v.movingAnchorElement:null,g?v.lastMovedAnchorElement:null),b=this.labels.values[t],y=this._getStyleForAnchor(e,t,m||g),x=this.viewModel.getBoundsForValueAtIndex(t),E=x.min,I=x.max,P=2===c.length?0===t?a.substitute(r.rangeMinimum,{value:e}):a.substitute(r.rangeMaximum,{value:e}):b,k=1===c.length?null:0===t?h+"-handle-"+(t+1):t===c.length-1?h+"-handle-"+(t-1):h+"-handle-"+(t-1)+" "+h+"-handle-"+(t+1);return _.tsx("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,"aria-controls":k,"aria-label":r.sliderValue,"aria-labelledby":d?h+"-label-"+t:null,"aria-orientation":p,"aria-valuemax":I.toString(),"aria-valuemin":E.toString(),"aria-valuenow":e.toString(),"aria-valuetext":P,bind:this,class:f,"data-thumb-index":t,"data-value":e,id:h+"-handle-"+t,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:y,tabIndex:0},_.tsx("span",{afterCreate:this._afterThumbCreate,bind:this,class:v.thumbElement,"data-thumb-index":t,"touch-action":"none"}),this.renderThumbLabel(t))}},t.prototype.renderThumbLabel=function(e){var t=this,n=t.id,i=t.labels,o=t.labelInputsEnabled,r=t.labelsVisible,a=t.state,s=i.values[e],l=this.classes(v.labelElement,r?null:v.hidden,o&&"disabled"!==a?v.labelElementInteractive:null);return _.tsx("span",{afterCreate:this._afterLabelCreate,"aria-hidden":!r,bind:this,class:l,"data-thumb-index":e,id:n+"-label-"+e,role:o?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):s)},t.prototype.renderValueInput=function(e){var t=this.values[e];return _.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":r.sliderValue,bind:this,class:v.labelInput,required:!0,tabIndex:0,type:"text",value:this._formatInputValue(t,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})},t.prototype.renderMax=function(){var e=this,t=e._isMaxInputActive,n=e.labels,i=e.rangeLabelInputsEnabled,o=e.rangeLabelsVisible,r=e.state,a=this.classes(v.maxElement,o?null:v.hidden,i&&"disabled"!==r?v.maxElementInteractive:null);return _.tsx("div",{"aria-hidden":!o,bind:this,class:a,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:i?"button":null,tabIndex:i?0:null},t?this.renderMaxInput():n.max)},t.prototype.renderMin=function(){var e=this,t=e._isMinInputActive,n=e.labels,i=e.rangeLabelInputsEnabled,o=e.rangeLabelsVisible,r=e.state,a=this.classes(v.minElement,o?null:v.hidden,i&&"disabled"!==r?v.minElementInteractive:null);return _.tsx("div",{"aria-hidden":!o,bind:this,class:a,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:i?"button":null,tabIndex:i?0:null},t?this.renderMinInput():n.min)},t.prototype.renderMaxInput=function(){return _.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":r.maximumValue,bind:this,class:v.rangeInput,required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})},t.prototype.renderMinInput=function(){return _.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":r.minimumValue,bind:this,class:v.rangeInput,required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})},t.prototype.renderExtraContentElements=function(){return _.tsx("div",{bind:this,class:v.extraContentElement},this.extraNodes)},t.prototype.renderTicksContainer=function(){var e=this;if(this.tickConfigs&&this.trackElement&&(0!==this._trackHeight||0!==this._trackWidth))return this.tickConfigs.map(function(t,n){return _.tsx("div",{key:"ticks-container",class:e.classes(v.ticksContainerElement)},e.renderTicks(t,n))})},t.prototype.renderTicks=function(e,t){var n=this,i=e.mode,o=e.values;if(this._tickElements[t]=[],"position"===i){var r=Array.isArray(o)?o:[o];return this._calculateTickPositions(r).map(function(i,o){return n.renderTickGroup(e,o,t,i)})}if("percent"===i&&Array.isArray(o)){var a=this,s=a.max,l=a.min,u=s-l,h=o.map(function(e){return n._applyPrecisionToPosition(e/100*u+l)});return this._calculateTickPositions(h).map(function(i,o){return n.renderTickGroup(e,o,t,i)})}var d=Array.isArray(o)&&o.length?o[0]:isNaN(o)?null:o,p=this._getTickCounts(d,e);return this._calculateEquidistantTickPositions(p).map(function(i,o){return n.renderTickGroup(e,o,t,i)})},t.prototype.renderTickGroup=function(e,t,n,i){var o="position"===e.mode?Array.isArray(e.values)?e.values[t]:e.values:this._valueFromPosition(i);if(u.isSome(o)&&!isNaN(o))return _.tsx("div",{afterCreate:this._afterTickGroupCreate,bind:this,"data-config":e,"data-position":i,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":o,key:"tick-group-"+t},this.renderTickLine(e,t,n,o,i),e.labelsVisible?this.renderTickLabel(e,t,n,o,i):null)},t.prototype.renderTickLine=function(e,t,n,i,o){return _.tsx("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":i.toString(),bind:this,class:v.tickElement,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":i,key:"tick-label-"+t,style:this._getPositionStyleForElement(i)})},t.prototype.renderTickLabel=function(e,t,n,i,o){var r=e.labelFormatFunction?e.labelFormatFunction(i,"tick",t):this.viewModel.getLabelForValue(i,"tick",t);return _.tsx("div",{afterCreate:this._afterTickLabelCreate,"aria-label":r,"aria-valuenow":i.toString(),"aria-valuetext":r,bind:this,class:v.tickLabelElement,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":i,key:"tick-label-"+t,style:"transform: translate(-50%); "+this._getPositionStyleForElement(i)},r)},t.prototype._afterBaseNodeCreate=function(e){this._baseNode&&this._observer.unobserve(this._baseNode),this._baseNode=e,this._observer.observe(this._baseNode)},t.prototype._afterTrackCreate=function(e){_.storeNode.call(this,e),d.applyLocal(e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()},t.prototype._afterSegmentCreate=function(e){this._segmentElements.push(e),d.applyLocal(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)},t.prototype._afterAnchorCreate=function(e){if(this._anchorElements.push(e),d.applyLocal(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){var t=e["data-thumb-index"],n=e["data-value"],i=this._thumbElements[t]||null,o=this._labelElements[t]||null;this.thumbCreatedFunction(t,n,i,o)}},t.prototype._afterAnchorUpdate=function(e){if(this._anchorElements.push(e),u.isSome(this._focusedAnchorIndex)){e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}},t.prototype._afterThumbCreate=function(e){this._thumbElements.push(e)},t.prototype._afterLabelCreate=function(e){this._labelElements.push(e),d.applyLocal(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)},t.prototype._afterInputCreate=function(e){e.focus(),e.select()},t.prototype._afterTickLineCreate=function(e){var t=e["data-tick-config-index"],n=e["data-tick-group-index"],i=this._tickElements[t];i[n]?i[n].line=e:i[n]={line:e,label:null}},t.prototype._afterTickLabelCreate=function(e){var t=e["data-tick-config-index"],n=e["data-tick-group-index"],i=this._tickElements[t];i[n]?i[n].label=e:i[n]={label:e,line:null}},t.prototype._afterTickGroupCreate=function(e){var t=e["data-config"];if(t&&t.tickCreatedFunction){var n=e["data-tick-config-index"],i=e["data-tick-group-index"],o=e["data-value"],r=this._tickElements[n][i];if(r){var a=r.line||null,s=r.label||null;t.tickCreatedFunction(o,a,s)}}},t.prototype._onAnchorKeyDown=function(e){if(!this._isDisabled()&&"editing"!==this.state){var t=e.target,n=s.eventKey(e),i=this,o=i._anchorElements,r=i.values,a=t["data-thumb-index"],l=o[a],h=r[a],d=this._isHorizontalLayout(),p=[g.moveAnchorUp,g.moveAnchorDown,g.moveAnchorLeft,g.moveAnchorRight];if(n===g.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=a,this.notifyChange("state");else if(p.indexOf(n)>-1){e.preventDefault();var c=this.steps,m=n===g.moveAnchorUp||n===g.moveAnchorRight?1:-1;if(u.isSome(c))this._toStep(a,this._isReversedLayout()?-1*m:m);else{var _=this._getPositionOfElement(l),v=this._isHorizontalLayout()?m:-1*m,f=_+v,b=0===this.precision?this._positionFromValue(this._valueFromPosition(f)+v):f;this._toPosition(a,b)}var y=this.values[a];h!==y&&(this._emitValueChangeEvent({index:a,oldValue:h,value:y}),this._emitThumbChangeEvent({index:a,oldValue:h,value:y}))}else if(n===g.moveAnchorToMax||n===g.moveAnchorToMin){e.preventDefault();var x=this._getAnchorBoundsInPixels(a),E=x.min,I=x.max,f=d?n===g.moveAnchorToMax?I:E:n===g.moveAnchorToMin?I:E;this._toPosition(a,f);var y=this.values[a];h!==y&&(this._emitValueChangeEvent({index:a,oldValue:h,value:y}),this._emitThumbChangeEvent({index:a,oldValue:h,value:y}))}}},t.prototype._onAnchorPointerDown=function(e){if(e.preventDefault(),!this._isDisabled()){var t=e.target,n=e.clientX,i=e.clientY,o=t["data-thumb-index"];void 0!==o&&(this._anchorElements[o]&&this._anchorElements[o].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:n,clientY:i,index:o,position:this._getPositionOfElement(this._anchorElements[o])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}},t.prototype._onAnchorPointerMove=function(e){if(e.preventDefault(),"editing"!==this.state&&this._dragStartInfo){var t=this,n=t.values,i=t._anchorElements,o=t._dragged,r=t._dragStartInfo,a=t._dragStartInfo,s=a.index,l=a.position,u=e.clientX,h=e.clientY,d=o?"drag":"start",p=i[s],c=this._getPositionOfElement(p),m=this._applyPrecisionToPosition(this._isHorizontalLayout()?l+u-r.clientX:l+h-r.clientY);if(c!==m){var _=n[s];this._dragged=!0,this._toPosition(s,m);var v=this.values[s];o?_!==v&&(this._emitValueChangeEvent({index:s,oldValue:_,value:v}),this._emitThumbDragEvent({index:s,state:d,value:v})):this._emitThumbDragEvent({index:s,state:d,value:_})}}},t.prototype._onAnchorPointerUp=function(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this._dragStartInfo){var t=this._dragStartInfo.index,n=this._dragged;this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=t,n?(this.notifyChange("state"),this._emitThumbDragEvent({index:t,state:"stop",value:this.values[t]})):this.scheduleRender()}},t.prototype._onTrackPointerDown=function(e){var t=this,n=t._dragStartInfo,i=t.snapOnClickEnabled,o=t.state,r=t.values;if(!this._isDisabled()&&"editing"!==o&&!n&&i&&r.length){var a=this.steps,s=e.clientX,l=e.clientY,h=this._getCursorPositionFromEvent(e),d=this._valueFromPosition(h),p=this._getIndexOfNearestValue(d);if(u.isSome(p)){var c=r[p],m=u.isSome(a)?this._calculateNearestStepPosition(h):h;this._toPosition(p,m),this._dragged=!0,this._dragStartInfo={clientX:s,clientY:l,index:p,position:m},this._focusedAnchorIndex=p,this.notifyChange("state"),this._emitThumbDragEvent({index:p,state:"start",value:c});var _=this.values[p];c!==_&&(this._emitThumbDragEvent({index:p,state:"drag",value:_}),this._emitValueChangeEvent({index:p,oldValue:c,value:_})),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}}},t.prototype._onSegmentPointerDown=function(e){e.preventDefault();var t=this.draggableSegmentsEnabled,n=e.target,i=n["data-segment-index"],o=n["data-min-thumb-index"],r=n["data-max-thumb-index"];!this._isDisabled()&&t&&u.isSome(o)&&u.isSome(r)&&(e.stopPropagation(),this._storeTrackDimensions(),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:i,details:this._normalizeSegmentDetails({min:this._getAnchorDetails(o),max:this._getAnchorDetails(r)})},this.notifyChange("state"),this._emitSegmentDragEvent({index:i,state:"start",thumbIndices:[o,r]}),document.addEventListener("pointerup",this._onSegmentPointerUp),document.addEventListener("pointermove",this._onSegmentPointerMove))},t.prototype._onSegmentPointerMove=function(e){if(this._segmentDragStartInfo){e.preventDefault();var t=this,n=t._trackHeight,i=t._trackWidth,o=t._segmentDragStartInfo,r=o.index,a=o.cursorPosition,s=o.details,l=s.min,u=s.max,h=l.index,d=l.position,p=l.value,c=u.index,m=u.position,_=u.value;this._dragged=!0;var v=this._getCursorPositionFromEvent(e);if(v!==a){var g=this._positionToPercent(a),f=this._positionToPercent(v),b=f-g,y=this._positionToPercent(d)+b,x=this._positionToPercent(m)+b,E=this._getAnchorBoundsAsPercents(h).min,I=this._getAnchorBoundsAsPercents(c).max,P=!1,k=!1;if(y<E?P=!0:x>I&&(k=!0),P){var A=this.viewModel.getBoundsForValueAtIndex(h),S=A.min,L=A.max,C=this._isPositionInverted()?L:S,M=C,w=_+(C-p);return void this._updateAnchorValues([h,c],[M,w])}if(k){var V=this.viewModel.getBoundsForValueAtIndex(c),S=V.min,L=V.max,C=this._isPositionInverted()?S:L,w=C,M=p+(C-_);return void this._updateAnchorValues([h,c],[M,w])}var F=this._isHorizontalLayout()?i:n,D=x/100*F,T=y/100*F,O=this.values,z=[O[h],O[c]],H=this._getValueForAnchorAtPosition(h,T),N=this._getValueForAnchorAtPosition(c,D);this._updateAnchorValues([h,c],[H,N]);[this.values[h],this.values[c]].every(function(e,t){return e===z[t]})||this._emitSegmentDragEvent({index:r,state:"drag",thumbIndices:[h,c]})}}},t.prototype._onSegmentPointerUp=function(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),this._segmentDragStartInfo){var t=this,n=t.max,i=t.min,o=t.values,r=this._segmentDragStartInfo,a=r.index,s=r.details,l=s.min.index,u=s.max.index,h=n-i,d=o[l],p=o[u];this._lastMovedHandleIndex=d===p?d>h/2?l:u:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:a,state:"stop",thumbIndices:[l,u]})}},t.prototype._storeTrackDimensions=function(){if(this.trackElement){var e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}},t.prototype._onLabelPointerDown=function(e){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))},t.prototype._onLabelPointerMove=function(e){this._isDisabled()||(this._dragged=!0)},t.prototype._onLabelPointerUp=function(e){if(!this._isDisabled()){var t=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&u.isSome(t)&&(this._activeLabelInputIndex=t),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}},t.prototype._onLabelInputBlur=function(e){var t=this,n=t._activeLabelInputIndex,i=t.values,o=t.viewModel,r=e.target,a=r.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),a){var s=this._parseInputValue(a,"value",n),l=i[n];o.setValue(n,s);var u=this.values[n];l!==u&&(this._emitValueChangeEvent({index:n,oldValue:l,value:u}),this._emitThumbChangeEvent({index:n,oldValue:l,value:u}))}},t.prototype._onInputKeyDown=function(e){if(!this._isDisabled()){var t=e.target,n=s.eventKey(e),i=g.hideInput1,o=g.hideInput2,r=g.hideInput3,a=this,l=a._activeLabelInputIndex,h=a._anchorElements,d=t;if(n===i||n===o||n===r){e.stopPropagation();var p=l;d.blur(),u.isSome(p)?h[p].focus():d.parentElement.focus()}}},t.prototype._onMaxLabelClick=function(e){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state"))},t.prototype._onMaxLabelKeyDown=function(e){this._isDisabled()||s.eventKey(e)!==g.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))},t.prototype._onMaxInputBlur=function(e){var t=e.target,n=t.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),n){var i=this.max;this.viewModel.set("max",this._parseInputValue(n,"max")),this.max!==i&&this._emitMaxChangeEvent({oldValue:i,value:this.max})}},t.prototype._onMinLabelClick=function(e){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state"))},t.prototype._onMinLabelKeyDown=function(e){this._isDisabled()||s.eventKey(e)!==g.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))},t.prototype._onMinInputBlur=function(){var e=event.target,t=e.value;if(this._isMinInputActive=!1,this.notifyChange("state"),t){var n=this.min;this.viewModel.set("min",this._parseInputValue(t,"min")),this.min!==n&&this._emitMinChangeEvent({oldValue:n,value:this.min})}},t.prototype._isDisabled=function(){return this.disabled||"disabled"===this.state},t.prototype._positionFromValue=function(e){var t=this,n=t.max,i=t.min,o=n-i;if(0===o)return 0;var r=this,a=r._trackHeight,s=r._trackWidth,l=this._isHorizontalLayout(),u=l?parseFloat((s*(e-i)/o).toFixed(2)):parseFloat((a*(n-e)/o).toFixed(2));return this._isReversedLayout()&&(u=l?s-u:a-u),u},t.prototype._valueFromPosition=function(e){var t=this,n=t._trackHeight,i=t._trackWidth,o=t.max,r=t.min,a=t.precision,s=o-r,l=this._isHorizontalLayout()?e*s/i+r:s*(1e3-e/n*1e3)/1e3+r;return this._isReversedLayout()&&(l=o+r-l),parseFloat(l.toFixed(a))},t.prototype._positionToPercent=function(e){var t=this,n=t._trackHeight,i=t._trackWidth,o=this._isHorizontalLayout()?i:n,r=100*e/o;return this._applyPrecisionToPosition(r)},t.prototype._applyPrecisionToPosition=function(e){return parseFloat(e.toFixed(this._positionPrecision))},t.prototype._isPositionInverted=function(){var e=this.layout;return"horizontal-reversed"===e||"vertical"===e},t.prototype._isHorizontalLayout=function(){return this.layout.indexOf("horizontal")>-1},t.prototype._isReversedLayout=function(){return this.layout.indexOf("reversed")>-1},t.prototype._normalizeSegmentDetails=function(e){if(this._isPositionInverted()){var t=e.min;return{min:e.max,max:t}}return e},t.prototype._parseInputValue=function(e,t,n){return this.inputParseFunction?this.inputParseFunction(e,t,n):this.viewModel.defaultInputParseFunction(e)},t.prototype._formatInputValue=function(e,t,n){return this.inputFormatFunction?this.inputFormatFunction(e,t,n):this.viewModel.defaultInputFormatFunction(e)},t.prototype._getAnchorDetails=function(e){return{index:e,position:this._getPositionOfElement(this._anchorElements[e]),value:this.values[e]}},t.prototype._updateAnchorStyle=function(e,t){var n=this._anchorElements[e];n&&(this._isHorizontalLayout()?n.style.left=""+t:n.style.top=""+t)},t.prototype._getStyleForAnchor=function(e,t,n){var i=this._zIndices[t],o=n?this._zIndexOffset+i:i;return this._getPositionStyleForElement(e)+"; z-index: "+o},t.prototype._getPositionStyleForElement=function(e){var t=this._positionFromValue(e),n=this._positionToPercent(t);return(this._isHorizontalLayout()?"left":"top")+": "+n+"%"},t.prototype._getPositionOfElement=function(e){var t=this._getDimensions(e.offsetParent),n=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(n.left-t.left):this._applyPrecisionToPosition(n.top-t.top)},t.prototype._updateAnchorValues=function(e,t){var n=this,i=e.map(function(e){return n.values[e]});e.forEach(function(e,i){return n._toValue(e,t[i])});var o=e.map(function(e){return n.values[e]});o.every(function(e,t){return e===i[t]})||this._emitValuesChangeEvent({indices:e,oldValues:i,values:o})},t.prototype._toValue=function(e,t){if(u.isSome(this.steps)){t=this._getStepValues()[this._getIndexOfNearestStepValue(t)]}this._updateAnchorStyle(e,this._getPositionStyleForElement(t)),this.viewModel.setValue(e,t)},t.prototype._toPosition=function(e,t){var n=u.isSome(this.steps)?this._getStepValueForAnchorAtPosition(e,t):this._getValueForAnchorAtPosition(e,t);this._updateAnchorStyle(e,this._getPositionStyleForElement(n)),this.viewModel.setValue(e,n)},t.prototype._getValueForAnchorAtPosition=function(e,t){var n,i,o=this._getAnchorBoundsInPixels(e),r=o.min,a=o.max,s=this.viewModel.getBoundsForValueAtIndex(e),l=s.min,u=s.max,h=null;return this._isPositionInverted()?(n=l,i=u):(n=u,i=l),h=t>a?n:t<r?i:this._valueFromPosition(t),h>u?h=u:h<l&&(h=l),h},t.prototype._getStepValueForAnchorAtPosition=function(e,t){var n=this._getStepValues(),i=this._calculateNearestStepPosition(t),o=this._getValueForAnchorAtPosition(e,i);return n[this._getIndexOfNearestStepValue(o)]},t.prototype._getAnchorBoundsAsPercents=function(e){var t=this._getAnchorBoundsInPixels(e),n=t.min,i=t.max;return{min:this._positionToPercent(n),max:this._positionToPercent(i)}},t.prototype._getAnchorBoundsInPixels=function(e){var t=this,n=t._anchorElements,i=t._trackHeight,o=t._trackWidth,r=t.thumbsConstrained,a=n[e-1],s=n[e+1],l=this._isHorizontalLayout()?o:i;return r?this._isPositionInverted()?{max:a?this._getPositionOfElement(a):l,min:s?this._getPositionOfElement(s):0}:{max:s?this._getPositionOfElement(s):l,min:a?this._getPositionOfElement(a):0}:{max:l,min:0}},t.prototype._getIndexOfNearestValue=function(e){return this.values.indexOf(this.values.reduce(function(t,n){return Math.abs(n-e)<Math.abs(t-e)?n:t}))},t.prototype._getCursorPositionFromEvent=function(e){var t=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-t.left:e.clientY-t.top},t.prototype._getStepValues=function(){var e=this.steps;if(Array.isArray(e))return e;for(var t=this,n=t.max,i=t.min,o=Math.ceil((n-i)/e),r=[],a=0;a<=o;a++){var s=i+e*a;r.push(s>n?n:s)}return r},t.prototype._toStep=function(e,t){var n=this,i=n.values,o=n.viewModel,r=i[e],a=this._getStepValues(),s=a.indexOf(r),l=null;if(s>-1){var u=a[s+t],h=this._positionFromValue(u);l=this._getStepValueForAnchorAtPosition(e,h)}else{l=a[this._getIndexOfNearestStepValue(r)+t]}o.setValue(e,l)},t.prototype._getIndexOfNearestStepValue=function(e){var t=this.steps;if(!u.isSome(t))return null;var n=this._getStepValues(),i=n.reduce(function(t,n){return Math.abs(n-e)<Math.abs(t-e)?n:t});return n.indexOf(i)},t.prototype._calculateNearestStepPosition=function(e){var t=this._valueFromPosition(e),n=this._getIndexOfNearestStepValue(t),i=this._getStepValues();return this._positionFromValue(i[n])},t.prototype._getTickCounts=function(e,t){var n=t.mode;return"count"===n||"position"===n?e||0:"percent"===n?100/e||0:0},t.prototype._calculateTickPositions=function(e){var t=this;return e.map(function(e){return t._positionFromValue(e)})},t.prototype._calculateEquidistantTickPositions=function(e){var t=this,n=t._trackWidth,i=t._trackHeight,o=this._isHorizontalLayout()?n:i,r=o/(e-1),a=[];if(1===e)return[o/2];for(var s=0;s<e;s++){var l=s*r;l<=o&&a.push(l)}return a},t.prototype._getDimensions=function(e){try{return e.getBoundingClientRect()}catch(e){if("object"==typeof e&&null!==e)return{top:0,bottom:0,left:0,width:0,height:0,right:0};throw e}},t.prototype._emitMaxChangeEvent=function(e){this.emit("max-change",n({},e,{type:"max-change"}))},t.prototype._emitMinChangeEvent=function(e){this.emit("min-change",n({},e,{type:"min-change"}))},t.prototype._emitValueChangeEvent=function(e){this.hasEventListener("value-change")&&f.warn("'value-change' is deprecated, watch the 'values' property instead."),this.emit("value-change",n({},e,{type:"value-change"}))},t.prototype._emitValuesChangeEvent=function(e){this.hasEventListener("value-change")&&f.warn("'values-change' is deprecated, watch the 'values' property instead."),this.emit("values-change",n({},e,{type:"values-change"}))},t.prototype._emitThumbChangeEvent=function(e){this.emit("thumb-change",n({},e,{type:"thumb-change"}))},t.prototype._emitThumbDragEvent=function(e){this.emit("thumb-drag",n({},e,{type:"thumb-drag"}))},t.prototype._emitSegmentDragEvent=function(e){this.emit("segment-drag",n({},e,{type:"segment-drag"}))},o([h.property(),_.renderable()],t.prototype,"disabled",void 0),o([h.property()],t.prototype,"extraNodes",void 0),o([h.property(),_.renderable()],t.prototype,"draggableSegmentsEnabled",void 0),o([h.property()],t.prototype,"label",void 0),o([h.aliasOf("viewModel.labelFormatFunction")],t.prototype,"labelFormatFunction",void 0),o([h.aliasOf("viewModel.inputFormatFunction")],t.prototype,"inputFormatFunction",void 0),o([h.aliasOf("viewModel.inputParseFunction")],t.prototype,"inputParseFunction",void 0),o([h.property()],t.prototype,"labelInputsEnabled",void 0),o([h.aliasOf("viewModel.labels")],t.prototype,"labels",void 0),o([h.property(),_.renderable()],t.prototype,"labelsVisible",void 0),o([h.property({value:"horizontal"}),_.renderable()],t.prototype,"layout",null),o([h.aliasOf("viewModel.max")],t.prototype,"max",void 0),o([h.aliasOf("viewModel.min")],t.prototype,"min",void 0),o([h.aliasOf("viewModel.precision")],t.prototype,"precision",void 0),o([h.property()],t.prototype,"rangeLabelInputsEnabled",void 0),o([h.property(),_.renderable()],t.prototype,"rangeLabelsVisible",void 0),o([h.property()],t.prototype,"snapOnClickEnabled",void 0),o([h.property({dependsOn:["viewModel.state"],readOnly:!0}),_.renderable()],t.prototype,"state",null),o([h.property(),_.renderable()],t.prototype,"steps",void 0),o([h.aliasOf("viewModel.thumbsConstrained")],t.prototype,"thumbsConstrained",void 0),
o([h.property()],t.prototype,"thumbCreatedFunction",void 0),o([h.property(),_.renderable()],t.prototype,"tickConfigs",void 0),o([h.property()],t.prototype,"trackElement",void 0),o([h.aliasOf("viewModel.values")],t.prototype,"values",void 0),o([h.property(),_.renderable(["viewModel.thumbsConstrained","viewModel.max","viewModel.min","viewModel.precision","viewModel.labelFormatFunction","viewModel.labels","viewModel.values"])],t.prototype,"viewModel",void 0),t=o([h.subclass("esri.widgets.Slider")],t)}(h.declared(c))});