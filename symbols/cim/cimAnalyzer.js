// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.12/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/generatorHelper","../../core/tsSupport/awaiterHelper","../../Color","../../core/Logger","../../core/promiseUtils","../../support/arcadeOnDemand","./CIMSymbolHelper","./enums","./SDFHelper","./utils","../../views/2d/arcade/utils"],function(e,t,r,n,i,o,a,s,l,c,u,f,h){function m(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function p(e){switch(e){case"Butt":return c.CapType.BUTT;case"Square":return c.CapType.SQUARE;case"Round":default:return c.CapType.ROUND}}function y(e){switch(e){case"Bevel":return c.JoinType.BEVEL;case"Miter":return c.JoinType.MITER;case"Round":default:return c.JoinType.ROUND}}function d(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function g(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function v(e,t,i,o){return n(this,void 0,void 0,function(){var n,a,s,l;return r(this,function(r){switch(r.label){case 0:if(n=o||[],!e)return[2,n];switch("CIMSymbolReference"===e.type?(a=e.symbol,s=e.primitiveOverrides):(a=e,s=null),l=a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":return[3,1];case"CIMTextSymbol":return[3,3]}return[3,4];case 1:return[4,S(a,s,t,i,n)];case 2:return r.sent(),[3,4];case 3:return[3,4];case 4:return[2,n]}})})}function S(e,t,i,o,a){return n(this,void 0,void 0,function(){var n,s,u,f,h,m,p;return r(this,function(r){switch(r.label){case 0:if(!e)return[2];if(!(n=e.symbolLayers))return[2];u=l.CIMSymbolHelper.getSize(e),"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(s=c.Alignment.MAP),f=n.length,r.label=1;case 1:if(!f--)return[3,23];if(!(h=n[f])||!1===h.enable)return[3,1];switch(m=[],l.OverrideHelper.findApplicableOverrides(h,t,m),p=h.type){case"CIMSolidFill":return[3,2];case"CIMPictureFill":return[3,4];case"CIMHatchFill":return[3,6];case"CIMGradientFill":return[3,8];case"CIMSolidStroke":return[3,10];case"CIMPictureStroke":return[3,12];case"CIMGradientStroke":return[3,14];case"CIMCharacterMarker":return[3,16];case"CIMPictureMarker":return[3,17];case"CIMVectorMarker":return[3,19]}return[3,21];case 2:return[4,b(h,m,o,a)];case 3:return r.sent(),[3,22];case 4:return[4,C(h,m,o,a)];case 5:return r.sent(),[3,22];case 6:return[4,O(h,m,o,a)];case 7:return r.sent(),[3,22];case 8:return[4,N(h,m,o,a)];case 9:return r.sent(),[3,22];case 10:return[4,M(h,m,o,a,"CIMPolygonSymbol"===e.type,u)];case 11:return r.sent(),[3,22];case 12:return[4,w(h,m,o,a,"CIMPolygonSymbol"===e.type,u)];case 13:return r.sent(),[3,22];case 14:return[4,k(h,m,o,a,"CIMPolygonSymbol"===e.type,u)];case 15:return r.sent(),[3,22];case 16:return[3,22];case 17:return[4,H(h,m,o,a,s,u)];case 18:return r.sent(),[3,22];case 19:return[4,I(h,m,i,o,a,s,u)];case 20:return r.sent(),[3,22];case 21:T.error("Cannot analyze CIM layer",h.type),r.label=22;case 22:return[3,1];case 23:return[2]}})})}function b(e,t,i,o){return n(this,void 0,void 0,function(){var n,a,s,l,c,u;return r(this,function(r){switch(r.label){case 0:return n=e.primitiveName,a=m(e.color),s=f.hashString(JSON.stringify(e)).toString(),c=(l=o).push,u={type:"fill",templateHash:s,materialHash:0===t.length?s:function(e,t,r){return s},cim:e,materialOverrides:null,colorLocked:e.colorLocked},[4,R(n,"Color",t,i,a,z)];case 1:return c.apply(l,[(u.color=r.sent(),u.height=0,u.angle=0,u.offsetX=0,u.offsetY=0,u.scaleX=1,u)]),[2]}})})}function C(e,t,i,o){return n(this,void 0,void 0,function(){var n,a,s,l,c,u,h;return r(this,function(r){switch(r.label){case 0:return n=e.primitiveName,a=m(e.tintColor),s=f.hashString(JSON.stringify(e)).toString(),l=f.hashString(""+e.url+JSON.stringify(e.colorSubstitutions)).toString(),u=(c=o).push,h={type:"fill",templateHash:s,materialHash:0===t.length?l:function(e,t,r){return l},cim:e,materialOverrides:null,colorLocked:e.colorLocked},[4,R(n,"TintColor",t,i,a,z)];case 1:return h.color=r.sent(),[4,R(n,"Height",t,i,e.height)];case 2:return h.height=r.sent(),[4,R(n,"ScaleX",t,i,e.scaleX)];case 3:return h.scaleX=r.sent(),[4,R(n,"Rotation",t,i,e.rotation)];case 4:return h.angle=r.sent(),[4,R(n,"OffsetX",t,i,e.offsetX)];case 5:return h.offsetX=r.sent(),[4,R(n,"OffsetY",t,i,e.offsetY)];case 6:return u.apply(c,[(h.offsetY=r.sent(),h)]),[2]}})})}function O(e,t,i,o){return n(this,void 0,void 0,function(){var n,a,s,l,c,u,h,m;return r(this,function(r){switch(r.label){case 0:return n=["Rotation","OffsetX","OffsetY"],(a=t.filter(function(t){return t.primitiveName!==e.primitiveName&&-1===n.indexOf(t.propertyName)}),s=e.primitiveName,l=f.hashString(JSON.stringify(e)).toString(),u=(c=o).push,h={type:"fill",templateHash:l},0!==t.length)?[3,1]:(m=l,[3,3]);case 1:return[4,A(l,a,i)];case 2:m=r.sent(),r.label=3;case 3:return h.materialHash=m,h.cim=e,h.materialOverrides=a,h.colorLocked=e.colorLocked,h.color={r:128,g:128,b:128,a:1},h.height=0,h.scaleX=1,[4,R(s,"Rotation",t,i,e.rotation)];case 4:return h.angle=r.sent(),[4,R(s,"OffsetX",t,i,e.offsetX)];case 5:return h.offsetX=r.sent(),[4,R(s,"OffsetY",t,i,e.offsetY)];case 6:return u.apply(c,[(h.offsetY=r.sent(),h)]),[2]}})})}function N(e,t,i,o){return n(this,void 0,void 0,function(){var n,a,s,l,c;return r(this,function(r){switch(r.label){case 0:return n=f.hashString(JSON.stringify(e)).toString(),(s=(a=o).push,l={type:"fill",templateHash:n},0!==t.length)?[3,1]:(c=n,[3,3]);case 1:return[4,A(n,t,i)];case 2:c=r.sent(),r.label=3;case 3:return s.apply(a,[(l.materialHash=c,l.cim=e,l.materialOverrides=null,l.colorLocked=e.colorLocked,l.color={r:128,g:128,b:128,a:1},l.height=0,l.angle=0,l.offsetX=0,l.offsetY=0,l.scaleX=1,l)]),[2]}})})}function M(e,t,i,o,a,s){return n(this,void 0,void 0,function(){var n,l,c,u,h,d,g,v,S,b;return r(this,function(r){switch(r.label){case 0:return n=f.hashString(JSON.stringify(e)).toString(),l=e.primitiveName,c=m(e.color),u=void 0!==e.width?e.width:4,h=p(e.capStyle),d=y(e.joinStyle),g=e.miterLimit,S=(v=o).push,b={type:"line",templateHash:n,materialHash:0===t.length?n:function(e,t,r){return n},cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked},[4,R(l,"Color",t,i,c,z)];case 1:return b.color=r.sent(),[4,R(l,"Width",t,i,u)];case 2:return b.width=r.sent(),[4,R(l,"CapStyle",t,i,h)];case 3:return b.cap=r.sent(),[4,R(l,"JoinStyle",t,i,d)];case 4:return b.join=r.sent(),[4,R(l,"MiterLimit",t,i,g)];case 5:return S.apply(v,[(b.miterLimit=r.sent(),b.referenceWidth=s,b.zOrder=x(e.name),b.isDashed=!1,b)]),[2]}})})}function w(e,t,i,o,a,s){return n(this,void 0,void 0,function(){var n,l,c,u,h,d,g,v,S,b,C;return r(this,function(r){switch(r.label){case 0:return n=f.hashString(""+e.url+JSON.stringify(e.colorSubstitutions)).toString(),l=e.primitiveName,c=m(e.tintColor),u=void 0!==e.width?e.width:4,h=p(e.capStyle),d=y(e.joinStyle),g=e.miterLimit,v=f.hashString(JSON.stringify(e)).toString(),b=(S=o).push,C={type:"line",templateHash:v,materialHash:0===t.length?n:function(e,t,r){return n},cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked},[4,R(l,"TintColor",t,i,c,z)];case 1:return C.color=r.sent(),[4,R(l,"Width",t,i,u)];case 2:return C.width=r.sent(),[4,R(l,"CapStyle",t,i,h)];case 3:return C.cap=r.sent(),[4,R(l,"JoinStyle",t,i,d)];case 4:return C.join=r.sent(),[4,R(l,"MiterLimit",t,i,g)];case 5:return b.apply(S,[(C.miterLimit=r.sent(),C.referenceWidth=s,C.zOrder=x(e.name),C.isDashed=!1,C)]),[2]}})})}function k(e,t,i,o,a,s){return n(this,void 0,void 0,function(){var n,l,c,u,h,m,d,g,v,S;return r(this,function(r){switch(r.label){case 0:return n=e.primitiveName,(l=void 0!==e.width?e.width:4,c=p(e.capStyle),u=y(e.joinStyle),h=e.miterLimit,m=f.hashString(JSON.stringify(e)).toString(),g=(d=o).push,v={type:"line",templateHash:m},0!==t.length)?[3,1]:(S=m,[3,3]);case 1:return[4,A(m,t,i)];case 2:S=r.sent(),r.label=3;case 3:return v.materialHash=S,v.cim=e,v.materialOverrides=null,v.isOutline=a,v.colorLocked=e.colorLocked,v.color={r:128,g:128,b:128,a:1},[4,R(n,"Width",t,i,l)];case 4:return v.width=r.sent(),[4,R(n,"CapStyle",t,i,c)];case 5:return v.cap=r.sent(),[4,R(n,"JoinStyle",t,i,u)];case 6:return v.join=r.sent(),[4,R(n,"MiterLimit",t,i,h)];case 7:return g.apply(d,[(v.miterLimit=r.sent(),v.referenceWidth=s,v.zOrder=x(e.name),v.isDashed=!1,v)]),[2]}})})}function H(e,t,i,o,a,s){return n(this,void 0,void 0,function(){var n,l,c,u,h,p,y,d,g,v,S;return r(this,function(r){switch(r.label){case 0:return n=e.primitiveName,l=e.size,c=e.scaleX,u=e.rotation,h=e.offsetX,p=e.offsetY,y=m(e.tintColor),d=f.hashString(""+e.url+JSON.stringify(e.colorSubstitutions)).toString(),v=(g=o).push,S={type:"marker",templateHash:f.hashString(JSON.stringify(e)).toString(),materialHash:0===t.length?d:function(e,t,r){return d},cim:e,materialOverrides:null,colorLocked:e.colorLocked,scaleSymbolsProportionally:!1,alignment:a,anchorPoint:e.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits},[4,R(n,"Size",t,i,l)];case 1:return S.size=r.sent(),[4,R(n,"ScaleX",t,i,c)];case 2:return S.scaleX=r.sent(),[4,R(n,"Rotation",t,i,u)];case 3:return S.rotation=r.sent(),[4,R(n,"OffsetX",t,i,h)];case 4:return S.offsetX=r.sent(),[4,R(n,"OffsetY",t,i,p)];case 5:return S.offsetY=r.sent(),[4,R(n,"TintColor",t,i,y,z)];case 6:return v.apply(g,[(S.color=r.sent(),S.outlineColor={r:0,g:0,b:0,a:0},S.outlineWidth=0,S.frameHeight=0,S.rotateClockwise=e.rotateClockwise,S.referenceSize=s,S.sizeRatio=1,S)]),[2]}})})}function I(e,t,i,o,s,l,c){return n(this,void 0,void 0,function(){var n,u,f,h,m,p,y,d;return r(this,function(r){switch(r.label){case 0:if(!(n=e.markerGraphics))return[2];for(u=0,e.scaleSymbolsProportionally&&(f=e.frame)&&(u=f.ymax-f.ymin),h=[],m=0,p=n;m<p.length;m++)if(y=p[m]){if(!(d=y.symbol))continue;switch(d.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":h.push(P(e,y,t,o,s,l,c,u));break;case"CIMTextSymbol":h.push(L(e,y,t,i,o,s,l,c,u))}}return[4,a.all(h)];case 1:return r.sent(),[2]}})})}function L(e,t,i,o,a,s,c,u,h){return n(this,void 0,void 0,function(){var n,p,y,v,S,b,C,O,N,M,w,k,H,I,L,P,X,x,z,J,A,F;return r(this,function(r){switch(r.label){case 0:if(n=[],l.OverrideHelper.findApplicableOverrides(t,i,n),p=t.geometry,void 0===p.x||void 0===p.y)return[2];for(y=t.symbol,y.font={family:y.fontFamilyName},v=e.frame,S=p.x-.5*(v.xmin+v.xmax),b=p.y-.5*(v.ymin+v.ymax),C=e.size/h,O=e.primitiveName,N=(y.height||0)*C,M=y.angle||0,w=((y.offsetX||0)+S)*C,k=((y.offsetY||0)+b)*C,H=m(l.CIMSymbolHelper.getFillColor(y)),I=m(l.CIMSymbolHelper.getStrokeColor(y)),L=l.CIMSymbolHelper.getStrokeWidth(y),L||(I=m(l.CIMSymbolHelper.getFillColor(y.haloSymbol)),L=y.haloSize*C),P="",X=0,x=i;X<x.length;X++)z=x[X],z.primitiveName===O&&void 0!==z.value&&(P+="|"+z.primitiveName+"|"+z.propertyName+"|"+JSON.stringify(z.value));return A=(J=s).push,F={type:"text",templateHash:f.hashString(JSON.stringify(t)+P).toString(),materialHash:function(e,t,r){return y.fontFamilyName},cim:y,materialOverrides:null,colorLocked:e.colorLocked,alignment:c,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:y.fontFamilyName,decoration:"none"},[4,R(O,"Height",i,a,N)];case 1:return F.size=r.sent(),[4,R(O,"Rotation",i,a,M)];case 2:return F.angle=r.sent(),[4,R(O,"OffsetX",i,a,w)];case 3:return F.offsetX=r.sent(),[4,R(O,"OffsetY",i,a,k)];case 4:return A.apply(J,[(F.offsetY=r.sent(),F.horizontalAlignment=d(y.horizontalAlignment),F.verticalAlignment=g(y.verticalAlignment),F.text=Y(o,a,t.textString,y.textCase),F.color=H,F.outlineColor=I,F.outlineSize=L,F.referenceSize=u,F.sizeRatio=1,F)]),[2]}})})}function P(e,t,i,o,a,s,c,h){return n(this,void 0,void 0,function(){var n,p,y,d,g,v;return r(this,function(S){switch(S.label){case 0:if(n=t.symbol,!(p=t.geometry))return[2];if(y=u.getExtent(p),!(d=n.symbolLayers))return[2];g=d.length,v=function(){var n,v,S,b,C,O,N,M,w,k,H,I,L,P,x,J,Y,F,T,W,D,U,E,j,B,G,_,q,V,$,K,Q,Z,C,O,ee,te,H,I,L,j,re,ne,ie,oe;return r(this,function(r){switch(r.label){case 0:if(!(n=d[g])||!1===n.enable)return[2,"continue"];switch(v=n.type){case"CIMSolidFill":case"CIMSolidStroke":return[3,1]}return[3,13];case 1:if(S=u.getSDFMetrics(y,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),b=S[0],C=S[1],O=S[2],N="CIMSolidFill"===n.type,M={type:"sdf",geom:p,asFill:N},w=e.primitiveName,k=e.size,H=e.rotation,I=e.offsetX,L=e.offsetY,P=n.primitiveName,x=m(N?l.CIMSymbolHelper.getFillColor(n):l.CIMSymbolHelper.getStrokeColor(n)),J=N?{r:0,g:0,b:0,a:0}:m(l.CIMSymbolHelper.getStrokeColor(n)),Y=l.CIMSymbolHelper.getStrokeWidth(n),!N&&!Y)return[3,20];for(F=!1,T="",W=0,D=i;W<D.length;W++)U=D[W],U.primitiveName!==P&&U.primitiveName!==w||(void 0!==U.value?T+="|"+U.primitiveName+"|"+U.propertyName+"|"+JSON.stringify(U.value):U.valueExpressionInfo&&(F=!0));return E=f.hashString(JSON.stringify(M)).toString(),j=f.hashString(JSON.stringify(n)+JSON.stringify(t)+T).toString(),G=(B=a).push,_={type:"marker",templateHash:j,materialHash:F?function(e,t,r){return E}:E,cim:M,materialOverrides:null,colorLocked:e.colorLocked,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:C,y:O},isAbsoluteAnchorPoint:!1},[4,R(w,"Size",i,o,k)];case 2:return _.size=r.sent(),_.scaleX=1,[4,R(w,"Rotation",i,o,H)];case 3:return _.rotation=r.sent(),[4,R(w,"OffsetX",i,o,I)];case 4:return _.offsetX=r.sent(),[4,R(w,"OffsetY",i,o,L)];case 5:return _.offsetY=r.sent(),[4,R(P,"Color",i,o,x,z)];case 6:return _.color=r.sent(),N?(q={r:0,g:0,b:0,a:0},[3,9]):[3,7];case 7:return[4,R(P,"Color",i,o,J,z)];case 8:q=r.sent(),r.label=9;case 9:return _.outlineColor=q,N?(V=0,[3,12]):[3,10];case 10:return[4,R(P,"Width",i,o,Y)];case 11:V=r.sent(),r.label=12;case 12:return G.apply(B,[(_.outlineWidth=V,_.frameHeight=h,_.rotateClockwise=e.rotateClockwise,_.referenceSize=c,_.sizeRatio=b,_)]),[3,20];case 13:return $=X(e,t),(K=[],Q=["Color","Size","Rotation","OffsetX","OffsetY"],K=i.filter(function(t){return t.primitiveName!==e.primitiveName&&-1===Q.indexOf(t.propertyName)}),Z=l.CIMSymbolHelper.getTextureAnchor($),C=Z[0],O=Z[1],ee=JSON.stringify($),te=e.primitiveName,H=e.rotation,I=e.offsetX,L=e.offsetY,j=f.hashString(JSON.stringify($)).toString(),ne=(re=a).push,ie={type:"marker",templateHash:j},0!==K.length)?[3,14]:(oe=j,[3,16]);case 14:return[4,A(ee,K,o)];case 15:oe=r.sent(),r.label=16;case 16:return ie.materialHash=oe,ie.cim=$,ie.materialOverrides=K,ie.colorLocked=e.colorLocked,ie.scaleSymbolsProportionally=e.scaleSymbolsProportionally,ie.alignment=s,ie.anchorPoint={x:C,y:O},ie.isAbsoluteAnchorPoint=!1,ie.size=e.size,ie.scaleX=1,[4,R(te,"Rotation",i,o,H)];case 17:return ie.rotation=r.sent(),[4,R(te,"OffsetX",i,o,I)];case 18:return ie.offsetX=r.sent(),[4,R(te,"OffsetY",i,o,L)];case 19:return ne.apply(re,[(ie.offsetY=r.sent(),ie.color={r:0,g:0,b:0,a:0},ie.outlineColor={r:0,g:0,b:0,a:0},ie.outlineWidth=0,ie.frameHeight=h,ie.rotateClockwise=e.rotateClockwise,ie.referenceSize=c,ie.sizeRatio=1,ie)]),[3,20];case 20:return[2]}})},S.label=1;case 1:return g--?[5,v()]:[3,3];case 2:return S.sent(),[3,1];case 3:return[2]}})})}function X(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:e.offsetX,offsetY:e.offsetY,rotateClockwise:e.rotateClockwise,rotation:e.rotation,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath}}function x(e){if(e&&0===e.indexOf("Level_")){var t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function z(e){if(!e||0===e.length)return null;var t=new i(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function R(e,t,i,o,a,l){return n(this,void 0,void 0,function(){var n,c,u,f,m;return r(this,function(p){switch(p.label){case 0:if(!e)return[3,4];n=function(n){var i,c,u;return r(this,function(r){switch(r.label){case 0:return n.primitiveName!==e||n.propertyName!==t?[3,2]:void 0!==n.value?[2,{value:n.value}]:(i=n.valueExpressionInfo)?(c=i.expression,[4,s.createRendererExpression(c,o.spatialReference,o.fields)]):[3,2];case 1:return u=r.sent(),[2,{value:function(e,t,r){var n=h.callWithFeature(u,e,{$view:r},o.geometryType,t);return null!==n&&l&&(n=l(n)),null!==n?n:a}}];case 2:return[2]}})},c=0,u=i,p.label=1;case 1:return c<u.length?(f=u[c],[5,n(f)]):[3,4];case 2:if("object"==typeof(m=p.sent()))return[2,m.value];p.label=3;case 3:return c++,[3,1];case 4:return[2,a]}})})}function J(e,t){switch(t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function Y(e,t,r,n){if(!e||-1===r.indexOf("["))return J(r,n);var i=" /-,\n",o=function(e){for(var t=e.length;t--;)if(-1===i.indexOf(e.charAt(t)))return!1;return!0},a=[],s=0,l=-1;do{if((l=r.indexOf("[",s))>=s){if(l>s){var c=r.substr(s,l-s);a.push([c,null,o(c)])}if(s=l+1,(l=r.indexOf("]",s))>=s){if(l>s){var u=r.substr(s,l-s),f=e[u];f&&a.push([null,f,!1])}s=l+1}}}while(-1!==l);if(s<r.length-1){var c=r.substr(s);a.push([c,null,o(c)])}return function(e,t,r){for(var i="",o=null,s=0,l=a;s<l.length;s++){var c=l[s],u=c[0],f=c[1],h=c[2];if(u)h?o=u:(o&&(i+=o,o=null),i+=u);else{var m=e.attributes[f];m&&(o&&(i+=o,o=null),i+=m)}}return J(i,n)}}function A(e,t,i){return n(this,void 0,void 0,function(){var n,o,a,c;return r(this,function(u){switch(u.label){case 0:n=function(e){var t,n,o;return r(this,function(r){switch(r.label){case 0:return(t=e.valueExpressionInfo)?(n=t.expression,[4,s.createRendererExpression(n,i.spatialReference,i.fields)]):[3,2];case 1:o=r.sent(),e.fn=function(e,t,r){return h.callWithFeature(o,e,{$view:r},i.geometryType,t)},r.label=2;case 2:return[2]}})},o=0,a=t,u.label=1;case 1:return o<a.length?(c=a[o],[5,n(c)]):[3,4];case 2:u.sent(),u.label=3;case 3:return o++,[3,1];case 4:return[2,function(r,n,i){for(var o=0,a=t;o<a.length;o++){var s=a[o];s.fn?s.value=s.fn(r,n,i):s.value=void 0}return f.hashString(e+l.OverrideHelper.buildOverrideKey(t)).toString()}]}})})}function F(e,t,r){if(!r||0===r.length)return t;var n=JSON.parse(JSON.stringify(t));return l.OverrideHelper.applyOverrides(n,r),n}Object.defineProperty(t,"__esModule",{value:!0});var T=o.getLogger("esri.symbols.cim.cimAnalyzer");t.analyzeCIMSymbol=v,t.analyzeCIMResource=F});